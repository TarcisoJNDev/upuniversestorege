<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Criar Produto - Admin</title>

  <link rel="stylesheet" href="../public/css/style(OFC).css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="../public/js/api.js"></script>
  <link rel="stylesheet" href="product-form.css">
  <style>
    /* CATEGORY SELECTOR STYLES */
    .category-selector-wrapper {
      position: relative;
      width: 100%;
    }

    .category-selector {
      width: 100%;
      position: relative;
    }

    .selected-category {
      padding: 14px 15px;
      background: rgba(11, 0, 21, 0.8);
      border: 1px solid rgba(124, 58, 237, 0.3);
      border-radius: 10px;
      color: #fff;
      font-size: 15px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s ease;
      min-height: 50px;
    }

    .selected-category:hover {
      border-color: #DF38FF;
    }

    .selected-category .placeholder {
      color: #666;
    }

    .selected-category .category-display {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .category-icon-small {
      font-size: 16px;
    }

    .category-dropdown {
      position: absolute;
      top: calc(100% + 5px);
      left: 0;
      right: 0;
      background: linear-gradient(135deg, #1a002b, #0b0015);
      border: 1px solid rgba(124, 58, 237, 0.3);
      border-radius: 10px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
      z-index: 1000;
      max-height: 400px;
      overflow-y: auto;
      display: none;
    }

    .category-dropdown.show {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    .category-option {
      padding: 12px 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      transition: all 0.3s ease;
      border-bottom: 1px solid rgba(124, 58, 237, 0.1);
    }

    .category-option:hover {
      background: rgba(124, 58, 237, 0.1);
    }

    .category-option:last-child {
      border-bottom: none;
    }

    .category-option.create-category {
      background: linear-gradient(135deg, rgba(223, 56, 255, 0.1), rgba(124, 58, 237, 0.1));
      border-left: 3px solid #DF38FF;
    }

    .category-option-content {
      display: flex;
      align-items: center;
      gap: 12px;
      color: #fff;
    }

    .category-option i {
      color: #DF38FF;
    }

    .category-name {
      font-weight: 500;
    }

    .category-path {
      font-size: 12px;
      color: #aaa;
      margin-left: 10px;
    }

    .category-add-btn {
      background: rgba(124, 58, 237, 0.2);
      border: none;
      border-radius: 6px;
      width: 30px;
      height: 30px;
      color: #C084FC;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .category-add-btn:hover {
      background: rgba(124, 58, 237, 0.4);
      transform: scale(1.1);
    }

    /* Subcategorias */
    .subcategory {
      padding-left: 30px;
      position: relative;
    }

    .subcategory::before {
      content: '‚Ü≥';
      position: absolute;
      left: 15px;
      color: #7C3AED;
      font-weight: bold;
    }

    .loading-categories {
      padding: 20px;
      text-align: center;
      color: #aaa;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    .no-categories {
      padding: 20px;
      text-align: center;
      color: #aaa;
    }

    /* Category Preview */
    .category-preview {
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(124, 58, 237, 0.1);
      padding: 8px 12px;
      border-radius: 6px;
      margin-top: 8px;
      border: 1px solid rgba(124, 58, 237, 0.2);
    }

    .category-preview i {
      color: inherit;
    }

    .clear-category {
      margin-left: auto;
      background: transparent;
      border: none;
      color: #f44336;
      cursor: pointer;
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 4px;
      transition: all 0.3s ease;
    }

    .clear-category:hover {
      background: rgba(244, 67, 54, 0.1);
    }

    /* Category Actions */
    .category-actions-container {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .btn-manage-categories {
      padding: 8px 15px;
      background: transparent;
      border: 1px solid rgba(124, 58, 237, 0.3);
      color: #C084FC;
      border-radius: 8px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-manage-categories:hover {
      background: rgba(124, 58, 237, 0.1);
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>

<body>
  <div class="admin-wrapper">
    <!-- Sidebar simplificada -->
    <aside
      style="width: 70px; background: #0b0015; border-right: 1px solid rgba(124, 58, 237, 0.2); padding: 20px 0; display: flex; flex-direction: column; align-items: center; gap: 30px; position: fixed; height: 100vh; z-index: 100;">
      <a href="dashboard.html" style="color: #C084FC; font-size: 20px;">
        <i class="fas fa-tachometer-alt"></i>
      </a>
      <a href="products.html" style="color: #C084FC; font-size: 20px;">
        <i class="fas fa-cube"></i>
      </a>
      <a href="product-form.html" style="color: #DF38FF; font-size: 20px;">
        <i class="fas fa-plus-circle"></i>
      </a>
      <a href="categories.html" style="color: #C084FC; font-size: 20px;">
        <i class="fas fa-tags"></i>
      </a>
    </aside>

    <!-- Main Content -->
    <main class="admin-main" style="margin-left: 70px; padding: 30px; width: calc(100% - 70px);">

      <div class="form-container">
        <!-- Tabs -->
        <div class="form-tabs">
          <button class="tab-button active" data-tab="basic">
            <i class="fas fa-info-circle"></i>
            Informa√ß√µes B√°sicas
          </button>
          <button class="tab-button" data-tab="images">
            <i class="fas fa-images"></i>
            Imagens
          </button>
          <button class="tab-button" data-tab="variants">
            <i class="fas fa-palette"></i>
            Variantes
          </button>
          <button class="tab-button" data-tab="details">
            <i class="fas fa-align-left"></i>
            Detalhes
          </button>
          <button class="tab-button" data-tab="seo">
            <i class="fas fa-search"></i>
            SEO
          </button>
        </div>

        <!-- Tab Contents -->
        <form id="productForm">
          <!-- TAB 1: Informa√ß√µes B√°sicas -->
          <div class="tab-content active" id="basicTab">
            <div class="form-grid">
              <div class="form-group">
                <label class="label-required">Nome do Produto</label>
                <input type="text" class="form-control" placeholder="Ex: Cr√¢nio T-Rex 3D" required>
                <div class="form-help">Nome completo do produto, como aparecer√° na loja</div>
              </div>

              <div class="form-group">
                <label class="label-required">Categoria</label>
                <div class="category-selector-wrapper">
                  <div class="category-selector" id="categorySelector">
                    <div class="selected-category" id="selectedCategory">
                      <span class="placeholder">Selecione uma categoria</span>
                      <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="category-dropdown" id="categoryDropdown">
                      <div class="category-option create-category" onclick="openCategoryForm()">
                        <div class="category-option-content">
                          <i class="fas fa-plus-circle"></i>
                          <span>Crie sua categoria</span>
                        </div>
                        <button class="category-add-btn" onclick="event.stopPropagation(); openCategoryForm();">
                          <i class="fas fa-plus"></i>
                        </button>
                      </div>
                      <div class="categories-list" id="categoriesList">
                        <!-- Categorias ser√£o carregadas aqui -->
                        <div class="loading-categories">
                          <i class="fas fa-spinner fa-spin"></i>
                          <span>Carregando categorias...</span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <input type="hidden" id="categoryId" name="categoryId">
                </div>
                <div class="category-actions-container">
                  <button type="button" class="btn-manage-categories" onclick="openCategoryManager()">
                    <i class="fas fa-external-link-alt"></i>
                    Gerenciar Categorias
                  </button>
                  <button type="button" class="btn-manage-categories" onclick="clearCategorySelection()"
                    id="clearCategoryBtn" style="display: none;">
                    <i class="fas fa-times"></i>
                    Limpar Sele√ß√£o
                  </button>
                </div>
              </div>

              <div class="form-group">
                <label>SKU (C√≥digo do Produto)</label>
                <input type="text" class="form-control" placeholder="Ex: PROD-001">
                <div class="form-help">C√≥digo √∫nico para controle de estoque</div>
              </div>

              <div class="form-group">
                <label class="label-required">Pre√ßo</label>
                <div style="display: flex; gap: 10px;">
                  <input type="number" class="form-control" placeholder="120.00" step="0.01" required style="flex: 1;">
                  <select class="form-control" style="width: 100px;">
                    <option>R$</option>
                    <option>US$</option>
                    <option>‚Ç¨</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label>Pre√ßo Promocional</label>
                <input type="number" class="form-control" placeholder="150.00" step="0.01">
                <div class="form-help">Pre√ßo original para mostrar o desconto</div>
              </div>

              <div class="form-group">
                <label class="label-required">Estoque</label>
                <input type="number" class="form-control" placeholder="12" min="0" required>
                <div class="form-help">Quantidade dispon√≠vel em estoque</div>
              </div>
            </div>

            <div class="form-group">
              <label>Descri√ß√£o Curta</label>
              <textarea class="form-control" placeholder="Breve descri√ß√£o do produto, mostrada nas listagens"
                maxlength="200"></textarea>
              <div class="form-help" style="text-align: right;">M√°ximo: 200 caracteres</div>
            </div>
          </div>

          <!-- Resto do formul√°rio permanece igual... -->
          <!-- TAB 2: Imagens -->
          <div class="tab-content" id="imagesTab">
            <div class="form-group">
              <label class="label-required">Imagem Principal</label>
              <div class="file-upload" id="mainImageUpload">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Clique para fazer upload da imagem principal</p>
                <small>Recomendado: 1200x1200px, JPG ou PNG, m√°ximo 5MB</small>
              </div>
              <div id="mainImagePreview" style="margin-top: 20px;"></div>
            </div>

            <div class="form-group">
              <label>Galeria de Imagens</label>
              <div class="file-upload" id="galleryUpload">
                <i class="fas fa-images"></i>
                <p>Clique ou arraste para adicionar imagens √† galeria</p>
                <small>Voc√™ pode selecionar m√∫ltiplas imagens</small>
              </div>
              <div id="imagePreview" class="image-gallery"></div>
            </div>
          </div>

          <!-- TAB 3: Variantes -->
          <div class="tab-content" id="variantsTab">
            <div class="variants-section">
              <h3><i class="fas fa-palette"></i> Op√ß√µes de Personaliza√ß√£o</h3>

              <!-- Tamanhos -->
              <div class="form-group">
                <label>Tamanhos Dispon√≠veis</label>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                  <label style="display: flex; align-items: center; gap: 5px;">
                    <input type="checkbox">
                    <span>Pequeno (15cm)</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 5px;">
                    <input type="checkbox" checked>
                    <span>M√©dio (25cm)</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 5px;">
                    <input type="checkbox">
                    <span>Grande (35cm)</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 5px;">
                    <input type="checkbox">
                    <span>Gigante (50cm)</span>
                  </label>
                </div>
              </div>

              <!-- Cores -->
              <div class="form-group">
                <label>Cores do Filamento</label>
                <div class="color-picker">
                  <div class="color-option selected" style="background: #8B7355;" title="Marrom Pedra"></div>
                  <div class="color-option" style="background: #A0522D;" title="Terra Queimada"></div>
                  <div class="color-option" style="background: #808080;" title="Cinza Fosco"></div>
                  <div class="color-option" style="background: #2F4F4F;" title="Verde Escuro"></div>
                  <div class="color-option" style="background: #000000;" title="Preto Profundo"></div>
                  <div class="color-option custom-color"
                    style="background: linear-gradient(45deg, #666 50%, transparent 50%);">
                    <input type="color" value="#7C3AED" title="Cor personalizada">
                  </div>
                </div>
              </div>

              <!-- Pre√ßos por variante -->
              <div class="form-group">
                <label>Pre√ßos por Tamanho</label>
                <div style="background: rgba(26, 0, 43, 0.5); border-radius: 10px; padding: 20px;">
                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                      <label style="display: block; margin-bottom: 8px; font-size: 13px;">Pequeno</label>
                      <input type="number" class="form-control" placeholder="80.00" step="0.01">
                    </div>
                    <div>
                      <label style="display: block; margin-bottom: 8px; font-size: 13px;">M√©dio</label>
                      <input type="number" class="form-control" placeholder="120.00" step="0.01">
                    </div>
                    <div>
                      <label style="display: block; margin-bottom: 8px; font-size: 13px;">Grande</label>
                      <input type="number" class="form-control" placeholder="180.00" step="0.01">
                    </div>
                    <div>
                      <label style="display: block; margin-bottom: 8px; font-size: 13px;">Gigante</label>
                      <input type="number" class="form-control" placeholder="250.00" step="0.01">
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <button type="button" class="btn-add-variant">
              <i class="fas fa-plus"></i>
              Adicionar Outra Op√ß√£o (Material, Textura, etc.)
            </button>
          </div>

          <!-- TAB 4: Detalhes -->
          <div class="tab-content" id="detailsTab">
            <div class="form-group">
              <label class="label-required">Descri√ß√£o Detalhada</label>
              <div class="rich-text-editor">
                <div class="editor-toolbar">
                  <button type="button" class="editor-btn" data-command="bold">
                    <i class="fas fa-bold"></i>
                  </button>
                  <button type="button" class="editor-btn" data-command="italic">
                    <i class="fas fa-italic"></i>
                  </button>
                  <button type="button" class="editor-btn" data-command="underline">
                    <i class="fas fa-underline"></i>
                  </button>
                  <div style="width: 1px; background: rgba(124, 58, 237, 0.2); margin: 0 5px;"></div>
                  <button type="button" class="editor-btn" data-command="insertUnorderedList">
                    <i class="fas fa-list-ul"></i>
                  </button>
                  <button type="button" class="editor-btn" data-command="insertOrderedList">
                    <i class="fas fa-list-ol"></i>
                  </button>
                  <div style="width: 1px; background: rgba(124, 58, 237, 0.2); margin: 0 5px;"></div>
                  <button type="button" class="editor-btn" data-command="createLink">
                    <i class="fas fa-link"></i>
                  </button>
                  <button type="button" class="editor-btn" data-command="unlink">
                    <i class="fas fa-unlink"></i>
                  </button>
                </div>
                <div class="editor-content" contenteditable="true"></div>
              </div>
            </div>

            <div class="form-grid">
              <div class="form-group">
                <label>Especifica√ß√µes T√©cnicas</label>
                <div style="background: rgba(26, 0, 43, 0.5); border-radius: 10px; padding: 20px;">
                  <div id="specifications">
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                      <input type="text" class="form-control" placeholder="Ex: Material">
                      <input type="text" class="form-control" placeholder="Ex: PLA Premium">
                      <button type="button"
                        style="background: transparent; border: 1px solid rgba(124, 58, 237, 0.3); color: #f44336; border-radius: 6px; width: 40px;">
                        <i class="fas fa-times"></i>
                      </button>
                    </div>
                  </div>
                  <button type="button"
                    style="margin-top: 10px; padding: 8px 15px; background: rgba(124, 58, 237, 0.1); border: 1px dashed rgba(124, 58, 237, 0.3); color: #C084FC; border-radius: 6px; width: 100%;">
                    <i class="fas fa-plus"></i> Adicionar Especifica√ß√£o
                  </button>
                </div>
              </div>

              <div class="form-group">
                <label>Informa√ß√µes de Envio</label>
                <div style="background: rgba(26, 0, 43, 0.5); border-radius: 10px; padding: 20px;">
                  <div style="margin-bottom: 15px;">
                    <label style="display: flex; align-items: center; gap: 10px;">
                      <input type="checkbox" checked>
                      <span>Produto f√≠sico (requer envio)</span>
                    </label>
                  </div>
                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                      <label style="display: block; margin-bottom: 8px; font-size: 13px;">Peso (kg)</label>
                      <input type="number" class="form-control" placeholder="0.45" step="0.01">
                    </div>
                    <div>
                      <label style="display: block; margin-bottom: 8px; font-size: 13px;">Dimens√µes (cm)</label>
                      <input type="text" class="form-control" placeholder="25x18x15">
                    </div>
                    <div>
                      <label style="display: block; margin-bottom: 8px; font-size: 13px;">Tempo de Produ√ß√£o</label>
                      <input type="text" class="form-control" placeholder="3-5 dias">
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="toggle-switch" style="margin-top: 20px;">
              <label class="switch">
                <input type="checkbox" checked>
                <span class="slider"></span>
              </label>
              <span>Dispon√≠vel para venda</span>
            </div>

            <div class="toggle-switch">
              <label class="switch">
                <input type="checkbox" checked>
                <span class="slider"></span>
              </label>
              <span>Destacar como produto em promo√ß√£o</span>
            </div>

            <div class="toggle-switch">
              <label class="switch">
                <input type="checkbox">
                <span class="slider"></span>
              </label>
              <span>Permitir avalia√ß√µes do produto</span>
            </div>
          </div>

          <!-- TAB 5: SEO -->
          <div class="tab-content" id="seoTab">
            <div class="form-group">
              <label>T√≠tulo SEO</label>
              <input type="text" class="form-control" placeholder="Cr√¢nio T-Rex 3D - Universo Paralelo Store">
              <div class="form-help">T√≠tulo que aparecer√° nos resultados de busca (recomendado: 50-60 caracteres)</div>
            </div>

            <div class="form-group">
              <label>Meta Descri√ß√£o</label>
              <textarea class="form-control" placeholder="Descri√ß√£o para os mecanismos de busca" rows="3"></textarea>
              <div class="form-help">Descri√ß√£o que aparecer√° nos resultados de busca (recomendado: 150-160 caracteres)
              </div>
            </div>

            <div class="form-group">
              <label>URL Amig√°vel (Slug)</label>
              <input type="text" class="form-control" placeholder="cranio-t-rex-3d">
              <div class="form-help">URL limpa para o produto (ex: seu-site.com/produtos/cranio-t-rex-3d)</div>
            </div>

            <div class="form-group">
              <label>Palavras-chave</label>
              <input type="text" class="form-control"
                placeholder="escultura 3d, t-rex, dinossauro, decora√ß√£o, impress√£o 3d">
              <div class="form-help">Separe por v√≠rgulas as palavras-chave relevantes</div>
            </div>

            <div class="seo-preview">
              <h4>Pr√©-visualiza√ß√£o do Resultado de Busca</h4>
              <div class="preview-item">
                <div class="preview-title">Cr√¢nio T-Rex 3D - Universo Paralelo Store</div>
                <div class="preview-url">https://universoparalelo.com/produtos/cranio-t-rex-3d</div>
                <div class="preview-description">Esta impressionante r√©plica do cr√¢nio do T-Rex √© perfeita para
                  apaixonados por paleontologia e decora√ß√£o √∫nica. Impressa em 3D com alta resolu√ß√£o, captura cada
                  detalhe...</div>
              </div>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <a href="products.html" class="btn-cancel">
              <i class="fas fa-times"></i>
              Cancelar
            </a>
            <button type="button" class="btn-save" id="saveDraftBtn">
              <i class="far fa-save"></i>
              Salvar Rascunho
            </button>
            <button type="submit" class="btn-save">
              <i class="fas fa-rocket"></i>
              Publicar Produto
            </button>
          </div>
        </form>
      </div>
    </main>
  </div>

  <script>
    // === FUN√á√ïES GLOBAIS ===
    function showNotification(message, type = 'info') {
      console.log(`üì¢ Notifica√ß√£o [${type}]: ${message}`);

      const notification = document.createElement('div');
      notification.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: linear-gradient(135deg, #1a002b, #0b0015);
    border: 2px solid ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#7C3AED'};
    color: white;
    padding: 15px 25px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    gap: 15px;
    z-index: 10000;
    animation: slideIn 0.3s ease;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    max-width: 400px;
  `;

      const icon = type === 'success' ? 'check-circle' :
        type === 'error' ? 'exclamation-circle' :
          type === 'warning' ? 'exclamation-triangle' : 'info-circle';

      notification.innerHTML = `
    <i class="fas fa-${icon}" style="color: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : type === 'warning' ? '#ff9800' : '#7C3AED'}; font-size: 20px;"></i>
    <span>${message}</span>
  `;

      document.body.appendChild(notification);

      setTimeout(() => {
        notification.style.animation = 'fadeOut 0.3s ease';
        setTimeout(() => notification.remove(), 300);
      }, 4000);
    }

    // === VARI√ÅVEIS GLOBAIS ===
    let allCategories = [];
    let mainImageData = null;
    let galleryImagesData = [];
    let collectAllFormData;

    // === CATEGORY SELECTOR FUNCTIONS ===
    async function loadCategories() {
      try {
        console.log("üì• Carregando categorias para o seletor...");

        const categoriesList = document.getElementById('categoriesList');
        if (categoriesList) {
          categoriesList.innerHTML = `
          <div class="loading-categories">
            <i class="fas fa-spinner fa-spin"></i>
            <span>Carregando categorias...</span>
          </div>
        `;
        }

        allCategories = await ProductAPI.getAllCategories();
        console.log(`‚úÖ ${allCategories.length} categorias carregadas`);

        allCategories.sort((a, b) => {
          if (!a.parent_id && b.parent_id) return -1;
          if (a.parent_id && !b.parent_id) return 1;
          return a.name.localeCompare(b.name);
        });

        renderCategories();

      } catch (error) {
        console.error("‚ùå Erro ao carregar categorias:", error);

        const categoriesList = document.getElementById('categoriesList');
        if (categoriesList) {
          categoriesList.innerHTML = `
          <div class="loading-categories" style="color: #f44336;">
            <i class="fas fa-exclamation-triangle"></i>
            <span>Erro ao carregar categorias</span>
            <button onclick="loadCategories()" style="margin-top: 10px; padding: 8px 15px; background: #7C3AED; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
              <i class="fas fa-sync-alt"></i> Tentar novamente
            </button>
          </div>
        `;
        }
      }
    }

    function renderCategories() {
      const categoriesList = document.getElementById('categoriesList');
      if (!categoriesList) return;

      if (allCategories.length === 0) {
        categoriesList.innerHTML = `
        <div class="no-categories">
          <i class="fas fa-tags"></i>
          <p>Nenhuma categoria criada</p>
          <p style="font-size: 12px; margin-top: 5px;">Clique em "Crie sua categoria" para come√ßar</p>
        </div>
      `;
        return;
      }

      let html = '';

      const mainCategories = allCategories.filter(cat => !cat.parent_id);
      const subCategories = allCategories.filter(cat => cat.parent_id);

      function createCategoryItem(category, isSubcategory = false) {
        const parent = category.parent_id ?
          allCategories.find(c => c.id == category.parent_id) : null;

        const icon = category.icon ?
          (category.icon.includes('fa-') ?
            `<i class="fas ${category.icon}"></i>` :
            `<span>${category.icon}</span>`) :
          `<i class="fas fa-tag"></i>`;

        const color = category.color || '#C084FC';

        return `
        <div class="category-option ${isSubcategory ? 'subcategory' : ''}" 
             onclick="selectCategory(${category.id})"
             data-category-id="${category.id}">
          <div class="category-option-content" style="color: ${color}">
            ${icon}
            <div>
              <div class="category-name">${category.name}</div>
              ${parent ? `<div class="category-path">${parent.name}</div>` : ''}
            </div>
          </div>
        </div>
      `;
      }

      mainCategories.forEach(category => {
        html += createCategoryItem(category);

        const categorySubCategories = subCategories.filter(sub => sub.parent_id == category.id);
        categorySubCategories.forEach(subCategory => {
          html += createCategoryItem(subCategory, true);
        });
      });

      categoriesList.innerHTML = html;
    }

    window.selectCategory = function (categoryId) {
        const category = allCategories.find(c => c.id == categoryId);
        if (!category) {
          console.error("‚ùå Categoria n√£o encontrada:", categoryId);
          showNotification('Categoria n√£o encontrada!', 'error');
          return;
        }

        const selectedCategory = document.getElementById('selectedCategory');
        const categoryIdInput = document.getElementById('categoryId');
        const clearBtn = document.getElementById('clearCategoryBtn');

        if (selectedCategory) {
          const icon = category.icon ?
            (category.icon.includes('fa-') ?
              `<i class="fas ${category.icon} category-icon-small"></i>` :
              `<span class="category-icon-small">${category.icon}</span>`) :
            `<i class="fas fa-tag category-icon-small"></i>`;

          const parent = category.parent_id ?
            allCategories.find(c => c.id == category.parent_id) : null;

          selectedCategory.innerHTML = `
      <div class="category-display" style="color: ${category.color || '#C084FC'}">
        ${icon}
        <div>
          <div><strong>${category.name}</strong></div>
          ${parent ? `<div style="font-size: 12px; color: #aaa;">${parent.name}</div>` : ''}
          <div style="font-size: 10px; color: #666; margin-top: 2px;">ID: ${category.id} | Nome: ${category.name}</div>
        </div>
      </div>
      <i class="fas fa-chevron-down"></i>
    `;
        }

        if (categoryIdInput) {
          categoryIdInput.value = category.id;
          console.log("‚úÖ Categoria selecionada - ID:", category.id, "Nome:", category.name);
        }

        if (clearBtn) {
          clearBtn.style.display = 'flex';
        }

        hideCategoryDropdown();

        showNotification(`‚úÖ Categoria selecionada: ${category.name}`, 'success');
      };

    window.clearCategorySelection = function () {
      const selectedCategory = document.getElementById('selectedCategory');
      const categoryIdInput = document.getElementById('categoryId');
      const clearBtn = document.getElementById('clearCategoryBtn');

      if (selectedCategory) {
        selectedCategory.innerHTML = `
        <span class="placeholder">Selecione uma categoria</span>
        <i class="fas fa-chevron-down"></i>
      `;
      }

      if (categoryIdInput) {
        categoryIdInput.value = '';
      }

      if (clearBtn) {
        clearBtn.style.display = 'none';
      }

      showNotification('Categoria removida', 'info');
    };

    function toggleCategoryDropdown() {
      const dropdown = document.getElementById('categoryDropdown');
      if (!dropdown) return;

      if (dropdown.classList.contains('show')) {
        hideCategoryDropdown();
      } else {
        showCategoryDropdown();
      }
    }

    function showCategoryDropdown() {
      const dropdown = document.getElementById('categoryDropdown');
      const selector = document.getElementById('categorySelector');

      if (dropdown && selector) {
        dropdown.classList.add('show');

        setTimeout(() => {
          document.addEventListener('click', closeDropdownOnClickOutside);
        }, 10);
      }
    }

    function hideCategoryDropdown() {
      const dropdown = document.getElementById('categoryDropdown');
      if (dropdown) {
        dropdown.classList.remove('show');
        document.removeEventListener('click', closeDropdownOnClickOutside);
      }
    }

    function closeDropdownOnClickOutside(event) {
      const selector = document.getElementById('categorySelector');
      const dropdown = document.getElementById('categoryDropdown');

      if (selector && !selector.contains(event.target) && dropdown) {
        hideCategoryDropdown();
      }
    }

    window.openCategoryForm = function () {
      const productData = collectAllFormData();
      if (productData.name || productData.price || productData.description) {
        const draftId = 'draft_product_category';
        localStorage.setItem(draftId, JSON.stringify(productData));
      }

      localStorage.setItem('cameFromProductForm', 'true');
      window.location.href = 'categories.html';
    };

    window.openCategoryManager = function () {
      localStorage.setItem('cameFromProductForm', 'true');

      const productData = collectAllFormData();
      if (productData.name || productData.price || productData.description) {
        localStorage.setItem('product_draft_current', JSON.stringify(productData));
      }

      window.location.href = 'categories.html';
    };

    function checkForNewCategory() {
      const newCategoryId = localStorage.getItem('newCategoryId');
      const newCategoryName = localStorage.getItem('newCategoryName');

      if (newCategoryId && newCategoryName) {
        loadCategories().then(() => {
          setTimeout(() => {
            selectCategory(parseInt(newCategoryId));
            showNotification(`Nova categoria "${newCategoryName}" selecionada!`, 'success');
          }, 500);
        });

        localStorage.removeItem('newCategoryId');
        localStorage.removeItem('newCategoryName');
      }
    }

    // === ANIMA√á√ïES CSS ===
    const style = document.createElement('style');
    style.textContent = `
  @keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
  @keyframes fadeOut {
    from { opacity: 1; transform: translateX(0); }
    to { opacity: 0; transform: translateX(100%); }
  }
`;
    document.head.appendChild(style);

    // === DEBUG HELPER ===
    window.debugForm = function () {
      if (typeof collectAllFormData === 'function') {
        const data = collectAllFormData();
        console.log("üîç DEBUG - Dados do formul√°rio:", data);
        alert(`Debug:\nNome: ${data.name}\nPre√ßo: R$ ${data.price}\nCategoria: ${data.category_id}\nStatus: ${data.status}`);
      } else {
        console.error("collectAllFormData n√£o est√° definida");
        alert("A fun√ß√£o collectAllFormData n√£o foi carregada ainda");
      }
    };

    // === FUN√á√ÉO PARA CARREGAR PRODUTO PARA EDI√á√ÉO ===
      async function loadProductForEdit(productId) {
        try {
          console.log(`üì• Carregando produto ${productId} para edi√ß√£o...`);

          // Mostrar loading
          const formContainer = document.querySelector('.form-container');
          if (formContainer) {
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'loadingProduct';
            loadingDiv.innerHTML = `
        <div style="text-align: center; padding: 40px; color: #C084FC;">
          <i class="fas fa-spinner fa-spin fa-2x"></i>
          <p style="margin-top: 10px;">Carregando produto...</p>
        </div>
      `;
            formContainer.insertBefore(loadingDiv, formContainer.firstChild);
          }

          // Buscar produto da API
          const product = await ProductAPI.getProductById(productId);

          if (!product) {
            showNotification('Produto n√£o encontrado!', 'error');
            window.location.href = 'products.html';
            return;
          }

          console.log("‚úÖ Produto carregado:", product);

          // Remover loading
          const loadingDiv = document.getElementById('loadingProduct');
          if (loadingDiv) loadingDiv.remove();

          // Preencher formul√°rio com dados do produto
          fillFormWithProductData(product);

          showNotification(`Pronto para editar: ${product.name}`, 'success');

        } catch (error) {
          console.error("‚ùå Erro ao carregar produto:", error);
          showNotification('Erro ao carregar produto para edi√ß√£o', 'error');

          // Voltar para lista de produtos ap√≥s 2 segundos
          setTimeout(() => {
            window.location.href = 'products.html';
          }, 2000);
        }
      }

      // === FUN√á√ÉO PARA ATUALIZAR PREVIEW SEO ===
        function updateSeoPreview() {
          const seoTitleInput = document.querySelector('#seoTab input[placeholder*="T√≠tulo SEO"]');
          const seoDescTextarea = document.querySelector('#seoTab textarea[placeholder*="Meta Descri√ß√£o"]');
          const seoUrlInput = document.querySelector('#seoTab input[placeholder*="URL Amig√°vel"]');

          if (!seoTitleInput || !seoDescTextarea || !seoUrlInput) return;

          const preview = document.querySelector('.seo-preview .preview-item');
          if (preview) {
            const titleEl = preview.querySelector('.preview-title');
            const urlEl = preview.querySelector('.preview-url');
            const descEl = preview.querySelector('.preview-description');

            if (seoTitleInput.value) titleEl.textContent = seoTitleInput.value;
            if (seoUrlInput.value) {
              const slug = seoUrlInput.value.toLowerCase()
                .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
                .replace(/[^\w\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-')
                .trim();
              urlEl.textContent = `https://universoparalelo.com/produtos/${slug}`;
            }
            if (seoDescTextarea.value) descEl.textContent = seoDescTextarea.value.substring(0, 160) + '...';
          }
        }

      // === FUN√á√ÉO PARA PREENCHER FORMUL√ÅRIO ===
      function fillFormWithProductData(product) {
        console.log("üìù Preenchendo formul√°rio com dados do produto...");

        // TAB 1: Informa√ß√µes B√°sicas
        const nameInput = document.querySelector('#basicTab input[placeholder*="Cr√¢nio T-Rex 3D"]');
        const priceInput = document.querySelector('#basicTab input[placeholder*="120.00"]');
        const stockInput = document.querySelector('#basicTab input[placeholder*="12"]');
        const shortDescTextarea = document.querySelector('#basicTab textarea');
        const skuInput = document.querySelector('#basicTab input[placeholder*="SKU"]');
        const promoPriceInput = document.querySelector('#basicTab input[placeholder*="150.00"]');

        if (nameInput) nameInput.value = product.name || '';
        if (priceInput) priceInput.value = product.price || '';
        if (stockInput) stockInput.value = product.stock || 0;
        if (shortDescTextarea) shortDescTextarea.value = product.short_description || '';
        if (skuInput) skuInput.value = product.sku || '';
        if (promoPriceInput) {
          promoPriceInput.value = product.promotional_price || '';
        }

        // Categoria
        if (product.category && allCategories && allCategories.length > 0) {
          const category = allCategories.find(c => c.name === product.category);
          if (category) {
            selectCategory(category.id);
          }
        }

        // TAB 2: Imagens (carregar ap√≥s categorias)
        setTimeout(() => {
          loadProductImages(product);
        }, 500);

        // TAB 4: Detalhes
        const editorContent = document.querySelector('.editor-content');
        if (editorContent && product.description) {
          editorContent.innerHTML = product.description;
        }

        // Status switches
        const statusSwitch = document.querySelector('#detailsTab .toggle-switch:first-child input[type="checkbox"]');
        if (statusSwitch) {
          statusSwitch.checked = product.status === 'active';
        }

        const featuredSwitch = document.querySelector('#detailsTab .toggle-switch:nth-child(2) input[type="checkbox"]');
        if (featuredSwitch) {
          featuredSwitch.checked = product.featured === true;
        }

        // TAB 5: SEO
        const seoTitleInput = document.querySelector('#seoTab input[placeholder*="T√≠tulo SEO"]');
        const seoDescTextarea = document.querySelector('#seoTab textarea[placeholder*="Meta Descri√ß√£o"]');
        const slugInput = document.querySelector('#seoTab input[placeholder*="URL Amig√°vel"]');
        const keywordsInput = document.querySelector('#seoTab input[placeholder*="Palavras-chave"]');

        if (seoTitleInput && product.seo && product.seo.title) {
          seoTitleInput.value = product.seo.title;
        }

        if (seoDescTextarea && product.seo && product.seo.description) {
          seoDescTextarea.value = product.seo.description;
        }

        if (slugInput && product.seo && product.seo.slug) {
          slugInput.value = product.seo.slug;
        }

        if (keywordsInput && product.seo && product.seo.keywords) {
          keywordsInput.value = Array.isArray(product.seo.keywords)
            ? product.seo.keywords.join(', ')
            : product.seo.keywords;
        }

        updateSeoPreview();
      }

      // === FUN√á√ÉO PARA CARREGAR IMAGENS DO PRODUTO ===
      function loadProductImages(product) {
        console.log("üñºÔ∏è Carregando imagens do produto...");

        // Imagem principal
        if (product.image_url) {
          const mainImagePreview = document.getElementById('mainImagePreview');
          if (mainImagePreview) {
            // URL da imagem
            let imageUrl = product.image_url;
            if (!imageUrl.startsWith('http') && !imageUrl.startsWith('data:image')) {
              if (imageUrl.startsWith('/')) {
                imageUrl = `http://localhost:5000${imageUrl}`;
              } else {
                imageUrl = `http://localhost:5000/uploads/${imageUrl}`;
              }
            }

            mainImagePreview.innerHTML = `
        <div class="preview-item">
          <img src="${imageUrl}" alt="${product.name}" 
               style="max-width: 200px; max-height: 200px; border-radius: 8px;">
          <div style="margin-top: 10px; font-size: 12px; color: #aaa;">
            Imagem atual do produto
          </div>
        </div>
      `;
          }
        }

        // Galeria de imagens
        if (product.images && product.images.length > 0) {
          const imageGallery = document.getElementById('imagePreview');
          if (imageGallery) {
            product.images.forEach((img, index) => {
              let imageUrl = img;
              if (!imageUrl.startsWith('http') && !imageUrl.startsWith('data:image')) {
                if (imageUrl.startsWith('/')) {
                  imageUrl = `http://localhost:5000${imageUrl}`;
                } else {
                  imageUrl = `http://localhost:5000/uploads/${imageUrl}`;
                }
              }

              const div = document.createElement('div');
              div.className = 'preview-item';
              div.innerHTML = `
          <img src="${imageUrl}" alt="Gallery image ${index + 1}" 
               style="max-width: 150px; max-height: 150px; border-radius: 8px;">
          <div style="font-size: 11px; color: #888; margin-top: 5px;">
            Imagem ${index + 1}
          </div>
        `;
              imageGallery.appendChild(div);
            });
          }
        }
      }

    document.addEventListener('DOMContentLoaded', async function () {
        console.log("üì± Formul√°rio carregado");

        // Verificar login
        const isLoggedIn = localStorage.getItem('adminLoggedIn') === 'true';
        if (!isLoggedIn) {
          window.location.href = 'login.html';
          return;
        }

        // === DETECTAR SE √â EDI√á√ÉO ===
        const urlParams = new URLSearchParams(window.location.search);
        const editProductId = urlParams.get('edit');

        // Vari√°vel para controlar se est√° editando
        let isEditing = false;
        let currentProductId = null;

        if (editProductId) {
          isEditing = true;
          currentProductId = parseInt(editProductId);
          console.log(`‚úèÔ∏è Modo EDI√á√ÉO ativado para produto ID: ${currentProductId}`);

          // Mudar t√≠tulo da p√°gina
          document.title = "Editar Produto - Admin";

          // Mudar t√≠tulo do formul√°rio
          const formTitle = document.querySelector('.form-container h1');
          if (!formTitle) {
            // Criar t√≠tulo se n√£o existir
            const formContainer = document.querySelector('.form-container');
            if (formContainer) {
              const title = document.createElement('h1');
              title.textContent = 'Editar Produto';
              title.style.cssText = 'color: #DF38FF; margin-bottom: 20px; font-size: 28px;';
              formContainer.insertBefore(title, formContainer.firstChild);
            }
          } else {
            formTitle.textContent = 'Editar Produto';
          }

          // Mudar bot√£o de submit
          const submitBtn = document.querySelector('#productForm button[type="submit"]');
          if (submitBtn) {
            submitBtn.innerHTML = '<i class="fas fa-save"></i> Salvar Altera√ß√µes';
          }
        } else {
          console.log("‚ûï Modo CRIA√á√ÉO ativado");
        }

      // === 1. INICIALIZAR CATEGORIA SELECTOR ===
      const selectedCategory = document.getElementById('selectedCategory');
      if (selectedCategory) {
        selectedCategory.addEventListener('click', toggleCategoryDropdown);
      }

            // Carregar categorias primeiro
      await loadCategories();

      // Se estiver editando, carregar produto
      if (isEditing && currentProductId) {
        await loadProductForEdit(currentProductId);
      }

      checkForNewCategory();


      const quickTestBtn = document.createElement('button');
      quickTestBtn.innerHTML = '‚ö° Teste R√°pido';
      quickTestBtn.style.cssText = `
    position: fixed;
    bottom: 180px;
    left: 20px;
    padding: 10px 15px;
    background: #FF9800;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    z-index: 10000;
    font-weight: bold;
  `;

      quickTestBtn.onclick = async function () {
        console.log("‚ö° Teste r√°pido iniciado...");

        // Criar uma imagem simples em base64
        const base64Image = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==';

        // Converter base64 para Blob
        const blob = await fetch(base64Image).then(r => r.blob());
        const testFile = new File([blob], 'test.png', { type: 'image/png' });

        const formData = new FormData();
        formData.append('name', 'Produto Teste com Imagem');
        formData.append('price', '99.99');
        formData.append('category', 'Teste');
        formData.append('stock', '5');
        formData.append('short_description', 'Produto de teste com imagem');
        formData.append('main_image', testFile);

        try {
          console.log("üì§ Enviando teste...");
          const response = await fetch('http://localhost:5000/api/products', {
            method: 'POST',
            body: formData
          });

          console.log("üì• Status:", response.status);
          const result = await response.json();
          console.log("Resultado:", result);

          if (result.success) {
            alert('‚úÖ Teste OK! Produto criado. Redirecionando...');
            setTimeout(() => {
              window.location.href = 'products.html';
            }, 1000);
          } else {
            alert(`‚ùå Erro: ${result.error}`);
          }
        } catch (error) {
          console.error("Erro no teste:", error);
          alert('‚ùå Falha: ' + error.message);
        }
      };

      document.body.appendChild(quickTestBtn);
    

      // === 2. SISTEMA DE TABS ===
      const tabButtons = document.querySelectorAll('.tab-button');
      const tabContents = document.querySelectorAll('.tab-content');

      tabButtons.forEach(button => {
        button.addEventListener('click', function () {
          const tabId = this.getAttribute('data-tab');

          tabButtons.forEach(btn => btn.classList.remove('active'));
          tabContents.forEach(content => content.classList.remove('active'));

          this.classList.add('active');
          const tabElement = document.getElementById(`${tabId}Tab`);
          if (tabElement) {
            tabElement.classList.add('active');
          }
        });
      });

      // === 3. GERENCIAMENTO DE IMAGENS ===
      const mainImageUpload = document.getElementById('mainImageUpload');
      const galleryUpload = document.getElementById('galleryUpload');
      const mainImagePreview = document.getElementById('mainImagePreview');
      const imageGallery = document.getElementById('imagePreview');

      if (mainImageUpload) {
        let mainImageFileInput = null;

        mainImageUpload.addEventListener('click', function () {
          // Criar input de arquivo se n√£o existir
          if (!mainImageFileInput) {
            mainImageFileInput = document.createElement('input');
            mainImageFileInput.type = 'file';
            mainImageFileInput.accept = 'image/*';
            mainImageFileInput.style.display = 'none';
            mainImageUpload.appendChild(mainImageFileInput);

            mainImageFileInput.onchange = function (e) {
              const file = e.target.files[0];
              if (file) {
                // Validar tipo de arquivo
                if (!file.type.match('image/(jpeg|jpg|png|gif|webp)')) {
                  showNotification('Formato de imagem n√£o suportado! Use JPG, PNG ou GIF.', 'error');
                  return;
                }

                // Validar tamanho (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                  showNotification('Imagem muito grande! M√°ximo 5MB.', 'error');
                  return;
                }

                const reader = new FileReader();
                reader.onload = function (event) {
                  mainImagePreview.innerHTML = `
                            <div class="preview-item">
                                <img src="${event.target.result}" alt="Preview" style="max-width: 200px; max-height: 200px; border-radius: 8px;">
                                <button type="button" class="remove-image" onclick="removeMainImage()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        `;
                  console.log("üì∑ Imagem principal carregada:", file.name, file.size + ' bytes');
                };
                reader.readAsDataURL(file);
              }
            };
          }

          mainImageFileInput.click();
        });
      }

      // Substitua o c√≥digo do upload da galeria:
      if (galleryUpload) {
        let galleryFileInput = null;

        galleryUpload.addEventListener('click', function () {
          // Criar input de arquivo se n√£o existir
          if (!galleryFileInput) {
            galleryFileInput = document.createElement('input');
            galleryFileInput.type = 'file';
            galleryFileInput.accept = 'image/*';
            galleryFileInput.multiple = true;
            galleryFileInput.style.display = 'none';
            galleryUpload.appendChild(galleryFileInput);

            galleryFileInput.onchange = function (e) {
              Array.from(e.target.files).forEach(file => {
                // Valida√ß√µes
                if (!file.type.match('image/(jpeg|jpg|png|gif|webp)')) {
                  showNotification(`Arquivo "${file.name}" n√£o √© uma imagem v√°lida!`, 'error');
                  return;
                }

                if (file.size > 5 * 1024 * 1024) {
                  showNotification(`Imagem "${file.name}" muito grande! M√°ximo 5MB.`, 'error');
                  return;
                }

                const reader = new FileReader();
                reader.onload = function (event) {
                  const div = document.createElement('div');
                  div.className = 'preview-item';
                  div.innerHTML = `
                            <img src="${event.target.result}" alt="Gallery image" style="max-width: 150px; max-height: 150px; border-radius: 8px;">
                            <button type="button" class="remove-image" onclick="removeGalleryImage(this)">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                  imageGallery.appendChild(div);

                  console.log("üñºÔ∏è Imagem da galeria adicionada:", file.name);
                };
                reader.readAsDataURL(file);
              });
            };
          }

          galleryFileInput.click();
        });
      }

     window.removeMainImage = function () {
        const mainImageUpload = document.getElementById('mainImageUpload');
        const input = mainImageUpload.querySelector('input[type="file"]');
        if (input) {
          input.value = ''; // Limpa o input de arquivo
        }
        const mainImagePreview = document.getElementById('mainImagePreview');
        if (mainImagePreview) {
          mainImagePreview.innerHTML = '';
        }
        console.log("üóëÔ∏è Imagem principal removida");
      };

      window.removeGalleryImage = function (button) {
        const item = button.closest('.preview-item');
        item.remove();
        console.log("üóëÔ∏è Imagem removida da galeria");

        // Nota: Para realmente remover o arquivo do FormData,
        // voc√™ precisaria recriar o input de arquivo ou usar um array de arquivos
      };

      // === 4. EDITOR DE TEXTO ===
      const editorButtons = document.querySelectorAll('.editor-btn');
      const editorContent = document.querySelector('.editor-content');

      if (editorButtons.length > 0 && editorContent) {
        editorButtons.forEach(button => {
          button.addEventListener('click', function () {
            const command = this.getAttribute('data-command');
            document.execCommand(command, false, null);
            editorContent.focus();
          });
        });
      }

      // === 5. ADICIONAR ESPECIFICA√á√ïES ===
      const allButtons = document.querySelectorAll('button');
      let addSpecBtn = null;

      for (let btn of allButtons) {
        if (btn.textContent.includes('Adicionar Especifica√ß√£o')) {
          addSpecBtn = btn;
          break;
        }
      }

      if (!addSpecBtn) {
        addSpecBtn = document.querySelector('#detailsTab button');
      }

      if (addSpecBtn) {
        addSpecBtn.addEventListener('click', function () {
          const specsContainer = document.getElementById('specifications');
          if (specsContainer) {
            const newSpec = document.createElement('div');
            newSpec.style.cssText = 'display: flex; gap: 10px; margin-bottom: 10px;';
            newSpec.innerHTML = `
          <input type="text" class="form-control" placeholder="Ex: Material">
          <input type="text" class="form-control" placeholder="Ex: PLA Premium">
          <button type="button" class="remove-spec" style="background: transparent; border: 1px solid rgba(124, 58, 237, 0.3); color: #f44336; border-radius: 6px; width: 40px;">
            <i class="fas fa-times"></i>
          </button>
        `;
            specsContainer.appendChild(newSpec);

            newSpec.querySelector('.remove-spec').addEventListener('click', function () {
              newSpec.remove();
            });

            console.log("‚ûï Especifica√ß√£o adicionada");
          }
        });
      }

      // === 6. FORMUL√ÅRIO PRINCIPAL ===
      const productForm = document.getElementById('productForm');
      const saveDraftBtn = document.getElementById('saveDraftBtn');

      if (!productForm) {
        console.error("‚ùå FORMUL√ÅRIO N√ÉO ENCONTRADO!");
        return;
      }

      // === 7. COLETA DE DADOS ===
     collectAllFormData = function () {
        console.log("üìã Coletando dados do formul√°rio...");

        // Criar FormData para envio de arquivos
        const formData = new FormData();

        // TAB 1: Informa√ß√µes B√°sicas
        const nameInput = document.querySelector('#basicTab input[placeholder*="Cr√¢nio T-Rex 3D"]');
        const categoryIdInput = document.getElementById('categoryId');
        const skuInput = document.querySelector('#basicTab input[placeholder*="SKU"]');
        const priceInput = document.querySelector('#basicTab input[placeholder*="120.00"]');
        const promoPriceInput = document.querySelector('#basicTab input[placeholder*="150.00"]');
        const stockInput = document.querySelector('#basicTab input[placeholder*="12"]');
        const shortDescTextarea = document.querySelector('#basicTab textarea');

        // Adicionar dados b√°sicos
        formData.append('name', nameInput ? nameInput.value : '');

        // Categoria
        const categoryId = categoryIdInput ? parseInt(categoryIdInput.value) || null : null;
        if (categoryId && allCategories.length > 0) {
          const categoryObj = allCategories.find(c => c.id == categoryId);
          if (categoryObj) {
            formData.append('category', categoryObj.name);
            formData.append('category_id', categoryObj.id);
          }
        }

        formData.append('price', priceInput ? parseFloat(priceInput.value) || 0 : 0);
        formData.append('promotional_price', promoPriceInput ? parseFloat(promoPriceInput.value) || '' : '');
        formData.append('stock', stockInput ? parseInt(stockInput.value) || 0 : 0);
        formData.append('sku', skuInput ? skuInput.value : '');
        formData.append('short_description', shortDescTextarea ? shortDescTextarea.value : '');

        // TAB 2: Imagens
        // Obter arquivo da imagem principal
        const mainImageFileInput = document.querySelector('#mainImageUpload input[type="file"]');
        if (mainImageFileInput && mainImageFileInput.files[0]) {
          formData.append('main_image', mainImageFileInput.files[0]);
        }

        // Obter arquivos da galeria
        const galleryFileInput = document.querySelector('#galleryUpload input[type="file"]');
        if (galleryFileInput && galleryFileInput.files) {
          for (let i = 0; i < galleryFileInput.files.length; i++) {
            formData.append('gallery_images', galleryFileInput.files[i]);
          }
        }

        // TAB 3: Variantes (converter para JSON)
        const variants = {
          sizes: [],
          colors: []
        };

        // Coletar tamanhos
        const sizeCheckboxes = document.querySelectorAll('#variantsTab input[type="checkbox"]');
        const sizePriceInputs = document.querySelectorAll('#variantsTab input[placeholder*="00"]');

        sizeCheckboxes.forEach((checkbox, index) => {
          if (checkbox.checked && checkbox.nextElementSibling) {
            const sizeText = checkbox.nextElementSibling.textContent.trim();
            const priceInput = sizePriceInputs[index];
            const sizePrice = priceInput ? parseFloat(priceInput.value) : null;

            variants.sizes.push({
              size: sizeText,
              price: sizePrice
            });
          }
        });

        // Cores
        const selectedColor = document.querySelector('#variantsTab .color-option.selected');
        if (selectedColor) {
          variants.colors = [selectedColor.getAttribute('title')];
        }

        formData.append('variants', JSON.stringify(variants));

        // TAB 4: Detalhes
        const description = editorContent ? editorContent.innerHTML : '';
        formData.append('description', description);

        // Especifica√ß√µes
        const specifications = [];
        const specElements = document.querySelectorAll('#detailsTab #specifications > div');
        specElements.forEach(spec => {
          const inputs = spec.querySelectorAll('input');
          if (inputs.length >= 2 && inputs[0].value && inputs[1].value) {
            specifications.push({
              key: inputs[0].value,
              value: inputs[1].value
            });
          }
        });

        formData.append('specifications', JSON.stringify(specifications));

        // Informa√ß√µes de envio
        const physicalCheckbox = document.querySelector('#detailsTab input[type="checkbox"]:first-of-type');
        const weightInput = document.querySelector('#detailsTab input[placeholder*="0.45"]');
        const dimensionsInput = document.querySelector('#detailsTab input[placeholder*="25x18x15"]');
        const productionInput = document.querySelector('#detailsTab input[placeholder*="3-5 dias"]');

        const shippingInfo = {
          is_physical: physicalCheckbox ? physicalCheckbox.checked : false,
          weight_kg: weightInput ? parseFloat(weightInput.value) || 0 : 0,
          dimensions_cm: dimensionsInput ? dimensionsInput.value : '',
          production_time: productionInput ? productionInput.value : ''
        };

        formData.append('shipping_info', JSON.stringify(shippingInfo));

        // Switches
        const switches = document.querySelectorAll('#detailsTab .toggle-switch input[type="checkbox"]');
        formData.append('featured', switches[1] ? (switches[1].checked ? 1 : 0) : 0);
        formData.append('status', switches[0] ? (switches[0].checked ? 'active' : 'inactive') : 'active');
        formData.append('settings', JSON.stringify({
          allow_reviews: switches[2] ? switches[2].checked : false
        }));

        // TAB 5: SEO
        const seoTitleInput = document.querySelector('#seoTab input[placeholder*="T√≠tulo SEO"]');
        const seoDescTextarea = document.querySelector('#seoTab textarea[placeholder*="Meta Descri√ß√£o"]');
        const slugInput = document.querySelector('#seoTab input[placeholder*="URL Amig√°vel"]');
        const keywordsInput = document.querySelector('#seoTab input[placeholder*="Palavras-chave"]');

        const seo = {
          title: seoTitleInput ? seoTitleInput.value : '',
          description: seoDescTextarea ? seoDescTextarea.value : '',
          slug: slugInput ? slugInput.value : '',
          keywords: keywordsInput ? keywordsInput.value.split(',').map(k => k.trim()).filter(k => k) : []
        };

        formData.append('seo', JSON.stringify(seo));

        // Material e dimens√µes
        const material = specifications.find(s => s.key && s.key.toLowerCase() === 'material')?.value || '';
        formData.append('material', material);
        formData.append('dimensions', dimensionsInput ? dimensionsInput.value : '');
        formData.append('weight', weightInput ? weightInput.value : '');

        console.log("‚úÖ FormData criado com sucesso");

        // Para debug, mostrar o que est√° sendo enviado
        for (let pair of formData.entries()) {
          console.log(`${pair[0]}:`, pair[0] === 'main_image' || pair[0] === 'gallery_images[]'
            ? `[Arquivo: ${pair[1].name}]`
            : pair[1]);
        }

        return formData;
      };
      // === 8. VALIDA√á√ÉO ===
      function validateProductData(data) {
        console.log("üîç Validando dados...");
        console.log("üìä Dados para valida√ß√£o:", {
          nome: data.name,
          preco: data.price,
          categoria: data.category,
          tipo_categoria: typeof data.category
        });

        if (!data.name || !data.name.trim()) {
          showNotification('Nome do produto √© obrigat√≥rio!', 'error');
          return false;
        }

        if (!data.category || !data.category.trim()) {
          showNotification('Categoria √© obrigat√≥ria! Selecione uma categoria.', 'error');
          console.error("‚ùå Categoria est√° vazia:", data.category);
          return false;
        }

        if (data.price <= 0) {
          showNotification('Pre√ßo deve ser maior que zero!', 'error');
          return false;
        }

        console.log("‚úÖ Valida√ß√£o passou com sucesso");
        return true;
      }

      // Adicione esta fun√ß√£o para verificar a categoria
      window.debugCategory = function () {
        const categoryIdInput = document.getElementById('categoryId');
        const categoryId = categoryIdInput ? categoryIdInput.value : null;

        console.log("üîç Debug Categoria:");
        console.log("üìå categoryId do input:", categoryId);
        console.log("üìå allCategories:", allCategories);

        if (categoryId && allCategories.length > 0) {
          const category = allCategories.find(c => c.id == categoryId);
          console.log("üìå Categoria encontrada:", category);

          if (category) {
            alert(`Categoria selecionada:\nID: ${category.id}\nNome: ${category.name}\nSlug: ${category.slug}`);
          } else {
            alert("‚ùå Categoria n√£o encontrada no array allCategories");
          }
        } else {
          alert("‚ùå Nenhuma categoria selecionada ou categorias n√£o carregadas");
        }
      };

      // Adicione um bot√£o de debug de categoria
      const debugCategoryBtn = document.createElement('button');
      debugCategoryBtn.textContent = 'üîç Categoria';
      debugCategoryBtn.style.cssText = 'position: fixed; bottom: 60px; left: 20px; padding: 10px 15px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer; z-index: 10000;';
      debugCategoryBtn.onclick = window.debugCategory;
      document.body.appendChild(debugCategoryBtn);

      // === 9. ENVIO DO FORMUL√ÅRIO ===
      // === 9. ENVIO DO FORMUL√ÅRIO (CRIA√á√ÉO OU EDI√á√ÉO) ===
      productForm.addEventListener('submit', async function (e) {
        e.preventDefault();

        if (isEditing) {
          console.log(`üîÑ Atualizando produto ID: ${currentProductId}...`);
          await updateProduct(currentProductId);
        } else {
          console.log("üöÄ Criando novo produto...");
          await createProduct();
        }
      });

      

      // === FUN√á√ÉO PARA CRIAR PRODUTO ===
     // === FUN√á√ÉO PARA CRIAR PRODUTO (VERS√ÉO FINAL) ===
     async function createProduct() {
        console.log("üöÄ Iniciando cria√ß√£o de produto...");

        const submitBtn = productForm.querySelector('button[type="submit"]');
        const originalHTML = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Publicando...';
        submitBtn.disabled = true;

        try {
          // Preparar FormData
          const formData = prepareFormData();

          // Determinar URL da API
          const API_URL = window.location.hostname === 'localhost'
            ? 'http://localhost:5000/api'
            : 'https://upuniversestorege.onrender.com/api';

          console.log("üì§ Enviando para:", `${API_URL}/products`);

          const response = await fetch(`${API_URL}/products`, {
            method: 'POST',
            body: formData
          });

          let result;
          const responseText = await response.text();

          try {
            result = JSON.parse(responseText);
          } catch (e) {
            console.error("‚ùå Resposta n√£o √© JSON:", responseText.substring(0, 200));
            throw new Error(`Servidor retornou: ${response.status} - ${response.statusText}`);
          }

          console.log("üì• Resposta:", result);

          if (response.ok && result.success) {
            showNotification('üéâ Produto publicado com sucesso!', 'success');

            setTimeout(() => {
              window.location.href = 'products.html';
            }, 2000);
          } else {
            showNotification(`‚ùå Erro: ${result.error || 'Falha ao criar produto'}`, 'error');
            submitBtn.innerHTML = originalHTML;
            submitBtn.disabled = false;
          }

        } catch (error) {
          console.error("üí• Erro:", error);
          showNotification(`‚ùå Erro: ${error.message}`, 'error');
          submitBtn.innerHTML = originalHTML;
          submitBtn.disabled = false;
        }
      }

      // === FUN√á√ÉO PARA ATUALIZAR PRODUTO ===
      async function updateProduct(productId) {
        console.log(`üîÑ Atualizando produto ID: ${productId}...`);

        const submitBtn = productForm.querySelector('button[type="submit"]');
        const originalHTML = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Salvando...';
        submitBtn.disabled = true;

        try {
          const formData = prepareFormData();

          const API_URL = window.location.hostname === 'localhost'
            ? 'http://localhost:5000/api'
            : 'https://upuniversestorege.onrender.com/api';

          const response = await fetch(`${API_URL}/products/${productId}`, {
            method: 'PUT',
            body: formData
          });

          let result;
          const responseText = await response.text();

          try {
            result = JSON.parse(responseText);
          } catch (e) {
            console.error("‚ùå Resposta n√£o √© JSON:", responseText.substring(0, 200));
            throw new Error(`Servidor retornou: ${response.status} - ${response.statusText}`);
          }

          if (response.ok && result.success) {
            showNotification('‚úÖ Produto atualizado com sucesso!', 'success');
            setTimeout(() => {
              window.location.href = 'products.html';
            }, 2000);
          } else {
            showNotification(`‚ùå Erro: ${result.error || 'Falha ao atualizar'}`, 'error');
            submitBtn.innerHTML = originalHTML;
            submitBtn.disabled = false;
          }

        } catch (error) {
          console.error("üí• Erro:", error);
          showNotification(`‚ùå Erro: ${error.message}`, 'error');
          submitBtn.innerHTML = originalHTML;
          submitBtn.disabled = false;
        }
      }

      // === FUN√á√ÉO PARA PREPARAR FORMDATA ===
      function prepareFormData() {
        console.log("üì¶ Preparando FormData para envio...");
        const formData = new FormData();

        // ===== INFORMA√á√ïES B√ÅSICAS =====
        const nameInput = document.querySelector('#basicTab input[placeholder*="Cr√¢nio T-Rex 3D"]');
        const priceInput = document.querySelector('#basicTab input[placeholder*="120.00"]');
        const stockInput = document.querySelector('#basicTab input[placeholder*="12"]');
        const shortDescTextarea = document.querySelector('#basicTab textarea');
        const skuInput = document.querySelector('#basicTab input[placeholder*="SKU"]');
        const promoPriceInput = document.querySelector('#basicTab input[placeholder*="150.00"]');
        const categoryIdInput = document.getElementById('categoryId');

        // VALIDA√á√ïES
        if (!nameInput || !nameInput.value.trim()) {
          showNotification('Nome do produto √© obrigat√≥rio!', 'error');
          throw new Error('Nome do produto √© obrigat√≥rio');
        }

        if (!categoryIdInput || !categoryIdInput.value) {
          showNotification('Selecione uma categoria!', 'error');
          throw new Error('Categoria √© obrigat√≥ria');
        }

        if (!priceInput || !priceInput.value || parseFloat(priceInput.value) <= 0) {
          showNotification('Pre√ßo deve ser maior que zero!', 'error');
          throw new Error('Pre√ßo inv√°lido');
        }

        // ADICIONAR DADOS B√ÅSICOS
        formData.append('name', nameInput.value.trim());
        formData.append('price', parseFloat(priceInput.value) || 0);
        formData.append('stock', stockInput ? parseInt(stockInput.value) || 0 : 0);
        formData.append('short_description', shortDescTextarea ? shortDescTextarea.value.trim() : '');
        formData.append('sku', skuInput ? skuInput.value.trim() : '');
        formData.append('category_id', parseInt(categoryIdInput.value));

        if (promoPriceInput && promoPriceInput.value) {
          formData.append('promotional_price', parseFloat(promoPriceInput.value));
        }

        // ADICIONAR NOME DA CATEGORIA (para compatibilidade)
        const category = allCategories.find(c => c.id == categoryIdInput.value);
        if (category) {
          formData.append('category', category.name);
          console.log(`‚úÖ Categoria: ${category.name} (ID: ${category.id})`);
        }

        // ===== IMAGEM PRINCIPAL =====
        const mainImageInput = document.querySelector('#mainImageUpload input[type="file"]');
        if (mainImageInput && mainImageInput.files[0]) {
          formData.append('main_image', mainImageInput.files[0]);
          console.log("üì∑ Imagem principal:", mainImageInput.files[0].name);
        }

        // ===== GALERIA DE IMAGENS =====
        const galleryInput = document.querySelector('#galleryUpload input[type="file"]');
        if (galleryInput && galleryInput.files) {
          for (let i = 0; i < galleryInput.files.length; i++) {
            formData.append('gallery_images', galleryInput.files[i]);
          }
          console.log(`üñºÔ∏è Galeria: ${galleryInput.files.length} imagem(ns)`);
        }

        // ===== DESCRI√á√ÉO DETALHADA =====
        const editorContent = document.querySelector('.editor-content');
        if (editorContent) {
          formData.append('description', editorContent.innerHTML || '');
        }

        // ===== VARIANTES =====
        const variants = { sizes: [], colors: [] };

        const sizeCheckboxes = document.querySelectorAll('#variantsTab input[type="checkbox"]');
        const sizePriceInputs = document.querySelectorAll('#variantsTab input[placeholder*="00"]');

        sizeCheckboxes.forEach((checkbox, index) => {
          if (checkbox.checked && checkbox.nextElementSibling) {
            const sizeText = checkbox.nextElementSibling.textContent.trim();
            const priceInput = sizePriceInputs[index];
            variants.sizes.push({
              size: sizeText,
              price: priceInput ? parseFloat(priceInput.value) : null
            });
          }
        });

        const selectedColor = document.querySelector('#variantsTab .color-option.selected');
        if (selectedColor) {
          variants.colors = [selectedColor.getAttribute('title') || 'Cor padr√£o'];
        }

        formData.append('variants', JSON.stringify(variants));

        // ===== ESPECIFICA√á√ïES =====
        const specifications = [];
        const specElements = document.querySelectorAll('#detailsTab #specifications > div');

        specElements.forEach(spec => {
          const inputs = spec.querySelectorAll('input');
          if (inputs.length >= 2 && inputs[0].value && inputs[1].value) {
            specifications.push({
              key: inputs[0].value.trim(),
              value: inputs[1].value.trim()
            });
          }
        });

        formData.append('specifications', JSON.stringify(specifications));

        // ===== INFORMA√á√ïES DE ENVIO =====
        const physicalCheckbox = document.querySelector('#detailsTab input[type="checkbox"]:first-of-type');
        const weightInput = document.querySelector('#detailsTab input[placeholder*="0.45"]');
        const dimensionsInput = document.querySelector('#detailsTab input[placeholder*="25x18x15"]');
        const productionInput = document.querySelector('#detailsTab input[placeholder*="3-5 dias"]');

        const shippingInfo = {
          is_physical: physicalCheckbox ? physicalCheckbox.checked : true,
          weight_kg: weightInput ? parseFloat(weightInput.value) || 0 : 0,
          dimensions_cm: dimensionsInput ? dimensionsInput.value.trim() : '',
          production_time: productionInput ? productionInput.value.trim() : ''
        };

        formData.append('shipping_info', JSON.stringify(shippingInfo));
        formData.append('dimensions', dimensionsInput ? dimensionsInput.value.trim() : '');
        formData.append('weight', weightInput ? weightInput.value.trim() : '');

        // ===== MATERIAL =====
        const materialSpec = specifications.find(s =>
          s.key && s.key.toLowerCase().includes('material')
        );
        formData.append('material', materialSpec ? materialSpec.value : '');

        // ===== STATUS E DESTAQUE =====
        const switches = document.querySelectorAll('#detailsTab .toggle-switch input[type="checkbox"]');
        formData.append('featured', switches[1] ? (switches[1].checked ? 1 : 0) : 0);
        formData.append('status', switches[0] ? (switches[0].checked ? 'active' : 'inactive') : 'active');

        const settings = {
          allow_reviews: switches[2] ? switches[2].checked : true
        };
        formData.append('settings', JSON.stringify(settings));

        // ===== SEO =====
        const seoTitleInput = document.querySelector('#seoTab input[placeholder*="T√≠tulo SEO"]');
        const seoDescTextarea = document.querySelector('#seoTab textarea[placeholder*="Meta Descri√ß√£o"]');
        const slugInput = document.querySelector('#seoTab input[placeholder*="URL Amig√°vel"]');
        const keywordsInput = document.querySelector('#seoTab input[placeholder*="Palavras-chave"]');

        const seo = {
          title: seoTitleInput ? seoTitleInput.value.trim() : '',
          description: seoDescTextarea ? seoDescTextarea.value.trim() : '',
          slug: slugInput ? slugInput.value.trim() : '',
          keywords: keywordsInput ? keywordsInput.value.split(',').map(k => k.trim()).filter(k => k) : []
        };

        formData.append('seo', JSON.stringify(seo));

        // DEBUG
        console.log("=== CONTE√öDO DO FORMDATA ===");
        for (let [key, value] of formData.entries()) {
          if (value instanceof File) {
            console.log(`üìÅ ${key}: ${value.name} (${value.size} bytes)`);
          } else {
            console.log(`üìù ${key}: ${value}`);
          }
        }
        console.log("=== FIM DEBUG ===");

        return formData;
      }

      // === FUN√á√ÉO PARA PROCESSAR RESPOSTA DA ATUALIZA√á√ÉO ===
      function handleUpdateResponse(response, result, submitBtn, originalHTML) {
        console.log("üì• Status da resposta:", response.status);
        console.log("Resposta da API:", result);

        if (response.ok && result.success) {
          showNotification('‚úÖ Produto atualizado com sucesso!', 'success');
          setTimeout(() => {
            window.location.href = 'products.html';
          }, 2000);
        } else {
          showNotification(`‚ùå Erro: ${result.error || 'N√£o foi poss√≠vel atualizar o produto'}`, 'error');
          submitBtn.innerHTML = originalHTML;
          submitBtn.disabled = false;
        }
      }

      // === 10. BOT√ÉO SALVAR RASCUNHO ===
      if (saveDraftBtn) {
        saveDraftBtn.addEventListener('click', function () {
          const productData = collectAllFormData();

          if (!productData.name) {
            showNotification('Digite pelo menos o nome do produto para salvar rascunho', 'warning');
            return;
          }

          const draftId = 'draft_' + Date.now();
          localStorage.setItem(draftId, JSON.stringify({
            data: productData,
            timestamp: new Date().toISOString(),
            title: productData.name || 'Novo produto'
          }));

          const drafts = JSON.parse(localStorage.getItem('product_drafts') || '[]');
          drafts.push({
            id: draftId,
            title: productData.name || 'Novo produto',
            timestamp: new Date().toISOString()
          });
          localStorage.setItem('product_drafts', JSON.stringify(drafts));

          showNotification('üìù Rascunho salvo com sucesso!', 'info');
        });
      }

      // === 11. FUN√á√ïES AUXILIARES ===
      const seoTitleInput = document.querySelector('#seoTab input[placeholder*="T√≠tulo SEO"]');
      const seoDescTextarea = document.querySelector('#seoTab textarea[placeholder*="Meta Descri√ß√£o"]');
      const seoUrlInput = document.querySelector('#seoTab input[placeholder*="URL Amig√°vel"]');

      if (seoTitleInput && seoDescTextarea && seoUrlInput) {
        seoTitleInput.addEventListener('input', updateSeoPreview);
        seoDescTextarea.addEventListener('input', updateSeoPreview);
        seoUrlInput.addEventListener('input', updateSeoPreview);

        function updateSeoPreview() {
          const preview = document.querySelector('.seo-preview .preview-item');
          if (preview) {
            const titleEl = preview.querySelector('.preview-title');
            const urlEl = preview.querySelector('.preview-url');
            const descEl = preview.querySelector('.preview-description');

            if (seoTitleInput.value) titleEl.textContent = seoTitleInput.value;
            if (seoUrlInput.value) urlEl.textContent = `https://universoparalelo.com/produtos/${seoUrlInput.value}`;
            if (seoDescTextarea.value) descEl.textContent = seoDescTextarea.value.substring(0, 160) + '...';
          }
        }

        updateSeoPreview();
      }

      const skuField = document.querySelector('#basicTab input[placeholder*="SKU"]');
      const nameField = document.querySelector('#basicTab input[placeholder*="Nome do Produto"]');

      if (skuField && nameField) {
        nameField.addEventListener('blur', function () {
          if (!skuField.value.trim()) {
            const sku = 'PROD-' + Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            skuField.value = sku;
          }
        });

        nameField.addEventListener('input', function () {
          if (seoUrlInput && !seoUrlInput.value.trim()) {
            const slug = this.value
              .toLowerCase()
              .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
              .replace(/[^\w\s-]/g, '')
              .replace(/\s+/g, '-')
              .replace(/-+/g, '-')
              .trim();
            seoUrlInput.value = slug;
            updateSeoPreview();
          }
        });
      }

      // === 12. BOT√ÉO DE DEBUG ===
      const debugBtn = document.createElement('button');
      debugBtn.textContent = 'üêõ Debug';
      debugBtn.style.cssText = 'position: fixed; bottom: 20px; left: 20px; padding: 10px 15px; background: #7C3AED; color: white; border: none; border-radius: 5px; cursor: pointer; z-index: 10000;';
      debugBtn.onclick = window.debugForm;
      document.body.appendChild(debugBtn);

      console.log("‚úÖ Formul√°rio inicializado com sucesso");
    });

    // Adicione este bot√£o de teste no seu product-form.html
      const testBtn = document.createElement('button');
      testBtn.textContent = 'üß™ Teste Simples';
      testBtn.style.cssText = 'position: fixed; bottom: 140px; left: 20px; padding: 10px 15px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; z-index: 10000;';

      /*
      // Modifique o bot√£o de teste para incluir uma imagem
        testBtn.onclick = async function () {
          console.log("üß™ Teste com imagem...");

          // Criar um arquivo de imagem fake para teste
          const blob = new Blob([''], { type: 'image/jpeg' });
          const testFile = new File([blob], 'test-image.jpg', { type: 'image/jpeg' });

          const formData = new FormData();
          formData.append('name', 'Produto Com Imagem');
          formData.append('price', '199.99');
          formData.append('category', 'Teste');
          formData.append('stock', '5');
          formData.append('main_image', testFile); // Adiciona imagem

          console.log("Enviando teste com imagem...");

          // Debug: mostrar campos
          console.log("Campos no FormData:");
          for (let [key, value] of formData.entries()) {
            console.log(`${key}:`, value instanceof File ? `[Arquivo: ${value.name}]` : value);
          }

          try {
            const response = await fetch('http://localhost:5000/api/products', {
              method: 'POST',
              body: formData
            });
            const result = await response.json();
            console.log("Resultado do teste:", result);
            alert(result.success ? '‚úÖ Teste com imagem OK!' : `‚ùå Erro: ${result.error}`);
          } catch (error) {
            console.error("Erro no teste:", error);
            alert('‚ùå Falha na conex√£o: ' + error.message);
          }
        };
      document.body.appendChild(testBtn);
      */
  </script>
</body>

</html>