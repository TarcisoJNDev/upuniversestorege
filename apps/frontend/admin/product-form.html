<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Criar Produto - Admin</title>
  
  <link rel="stylesheet" href="../public/css/style(OFC).css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="../public/js/api.js"></script>
  <link rel="stylesheet" href="product-form.css">
</head>

<body>
  <div class="admin-wrapper">
    <!-- Sidebar simplificada -->
    <aside
      style="width: 70px; background: #0b0015; border-right: 1px solid rgba(124, 58, 237, 0.2); padding: 20px 0; display: flex; flex-direction: column; align-items: center; gap: 30px; position: fixed; height: 100vh;">
      <a href="dashboard.html" style="color: #C084FC; font-size: 20px;">
        <i class="fas fa-tachometer-alt"></i>
      </a>
      <a href="products.html" style="color: #C084FC; font-size: 20px;">
        <i class="fas fa-cube"></i>
      </a>
      <a href="product-form.html" style="color: #DF38FF; font-size: 20px;">
        <i class="fas fa-plus-circle"></i>
      </a>
      <a href="categories.html" style="color: #C084FC; font-size: 20px;">
        <i class="fas fa-tags"></i>
      </a>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">


      <div class="form-container">
        <!-- Tabs -->
        <div class="form-tabs">
          <button class="tab-button active" data-tab="basic">
            <i class="fas fa-info-circle"></i>
            Informa√ß√µes B√°sicas
          </button>
          <button class="tab-button" data-tab="images">
            <i class="fas fa-images"></i>
            Imagens
          </button>
          <button class="tab-button" data-tab="variants">
            <i class="fas fa-palette"></i>
            Variantes
          </button>
          <button class="tab-button" data-tab="details">
            <i class="fas fa-align-left"></i>
            Detalhes
          </button>
          <button class="tab-button" data-tab="seo">
            <i class="fas fa-search"></i>
            SEO
          </button>
        </div>

        <!-- Tab Contents -->
        <form id="productForm">
          <!-- TAB 1: Informa√ß√µes B√°sicas -->
          <div class="tab-content active" id="basicTab">
            <div class="form-grid">
              <div class="form-group">
                <label class="label-required">Nome do Produto</label>
                <input type="text" class="form-control" placeholder="Ex: Cr√¢nio T-Rex 3D" required>
                <div class="form-help">Nome completo do produto, como aparecer√° na loja</div>
              </div>

              <div class="form-group">
                <label class="label-required">Categoria</label>
                <select class="form-control" required>
                  <option value="">Selecione uma categoria</option>
                  <option value="esculturas">Esculturas 3D</option>
                  <option value="decoracao">Decora√ß√£o</option>
                  <option value="utilitarios">Utilit√°rios</option>
                  <option value="prototipos">Prot√≥tipos</option>
                  <option value="brinquedos">Brinquedos</option>
                </select>
              </div>

              <div class="form-group">
                <label>SKU (C√≥digo do Produto)</label>
                <input type="text" class="form-control" placeholder="Ex: PROD-001">
                <div class="form-help">C√≥digo √∫nico para controle de estoque</div>
              </div>

              <div class="form-group">
                <label class="label-required">Pre√ßo</label>
                <div style="display: flex; gap: 10px;">
                  <input type="number" class="form-control" placeholder="120.00" step="0.01" required style="flex: 1;">
                  <select class="form-control" style="width: 100px;">
                    <option>R$</option>
                    <option>US$</option>
                    <option>‚Ç¨</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label>Pre√ßo Promocional</label>
                <input type="number" class="form-control" placeholder="150.00" step="0.01">
                <div class="form-help">Pre√ßo original para mostrar o desconto</div>
              </div>

              <div class="form-group">
                <label class="label-required">Estoque</label>
                <input type="number" class="form-control" placeholder="12" min="0" required>
                <div class="form-help">Quantidade dispon√≠vel em estoque</div>
              </div>
            </div>

            <div class="form-group">
              <label>Descri√ß√£o Curta</label>
              <textarea class="form-control" placeholder="Breve descri√ß√£o do produto, mostrada nas listagens"
                maxlength="200"></textarea>
              <div class="form-help" style="text-align: right;">M√°ximo: 200 caracteres</div>
            </div>
          </div>

          <!-- TAB 2: Imagens -->
          <div class="tab-content" id="imagesTab">
            <div class="form-group">
              <label class="label-required">Imagem Principal</label>
              <div class="file-upload" id="mainImageUpload">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Clique para fazer upload da imagem principal</p>
                <small>Recomendado: 1200x1200px, JPG ou PNG, m√°ximo 5MB</small>
              </div>
              <div id="mainImagePreview" style="margin-top: 20px;"></div>
            </div>

            <div class="form-group">
              <label>Galeria de Imagens</label>
              <div class="file-upload" id="galleryUpload">
                <i class="fas fa-images"></i>
                <p>Clique ou arraste para adicionar imagens √† galeria</p>
                <small>Voc√™ pode selecionar m√∫ltiplas imagens</small>
              </div>
              <div id="imagePreview" class="image-gallery"></div>
            </div>
          </div>

          <!-- TAB 3: Variantes -->
          <div class="tab-content" id="variantsTab">
            <div class="variants-section">
              <h3><i class="fas fa-palette"></i> Op√ß√µes de Personaliza√ß√£o</h3>

              <!-- Tamanhos -->
              <div class="form-group">
                <label>Tamanhos Dispon√≠veis</label>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                  <label style="display: flex; align-items: center; gap: 5px;">
                    <input type="checkbox">
                    <span>Pequeno (15cm)</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 5px;">
                    <input type="checkbox" checked>
                    <span>M√©dio (25cm)</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 5px;">
                    <input type="checkbox">
                    <span>Grande (35cm)</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 5px;">
                    <input type="checkbox">
                    <span>Gigante (50cm)</span>
                  </label>
                </div>
              </div>

              <!-- Cores -->
              <div class="form-group">
                <label>Cores do Filamento</label>
                <div class="color-picker">
                  <div class="color-option selected" style="background: #8B7355;" title="Marrom Pedra"></div>
                  <div class="color-option" style="background: #A0522D;" title="Terra Queimada"></div>
                  <div class="color-option" style="background: #808080;" title="Cinza Fosco"></div>
                  <div class="color-option" style="background: #2F4F4F;" title="Verde Escuro"></div>
                  <div class="color-option" style="background: #000000;" title="Preto Profundo"></div>
                  <div class="color-option custom-color"
                    style="background: linear-gradient(45deg, #666 50%, transparent 50%);">
                    <input type="color" value="#7C3AED" title="Cor personalizada">
                  </div>
                </div>
              </div>

              <!-- Pre√ßos por variante -->
              <div class="form-group">
                <label>Pre√ßos por Tamanho</label>
                <div style="background: rgba(26, 0, 43, 0.5); border-radius: 10px; padding: 20px;">
                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                      <label style="display: block; margin-bottom: 8px; font-size: 13px;">Pequeno</label>
                      <input type="number" class="form-control" placeholder="80.00" step="0.01">
                    </div>
                    <div>
                      <label style="display: block; margin-bottom: 8px; font-size: 13px;">M√©dio</label>
                      <input type="number" class="form-control" placeholder="120.00" step="0.01">
                    </div>
                    <div>
                      <label style="display: block; margin-bottom: 8px; font-size: 13px;">Grande</label>
                      <input type="number" class="form-control" placeholder="180.00" step="0.01">
                    </div>
                    <div>
                      <label style="display: block; margin-bottom: 8px; font-size: 13px;">Gigante</label>
                      <input type="number" class="form-control" placeholder="250.00" step="0.01">
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <button type="button" class="btn-add-variant">
              <i class="fas fa-plus"></i>
              Adicionar Outra Op√ß√£o (Material, Textura, etc.)
            </button>
          </div>

          <!-- TAB 4: Detalhes -->
          <div class="tab-content" id="detailsTab">
            <div class="form-group">
              <label class="label-required">Descri√ß√£o Detalhada</label>
              <div class="rich-text-editor">
                <div class="editor-toolbar">
                  <button type="button" class="editor-btn" data-command="bold">
                    <i class="fas fa-bold"></i>
                  </button>
                  <button type="button" class="editor-btn" data-command="italic">
                    <i class="fas fa-italic"></i>
                  </button>
                  <button type="button" class="editor-btn" data-command="underline">
                    <i class="fas fa-underline"></i>
                  </button>
                  <div style="width: 1px; background: rgba(124, 58, 237, 0.2); margin: 0 5px;"></div>
                  <button type="button" class="editor-btn" data-command="insertUnorderedList">
                    <i class="fas fa-list-ul"></i>
                  </button>
                  <button type="button" class="editor-btn" data-command="insertOrderedList">
                    <i class="fas fa-list-ol"></i>
                  </button>
                  <div style="width: 1px; background: rgba(124, 58, 237, 0.2); margin: 0 5px;"></div>
                  <button type="button" class="editor-btn" data-command="createLink">
                    <i class="fas fa-link"></i>
                  </button>
                  <button type="button" class="editor-btn" data-command="unlink">
                    <i class="fas fa-unlink"></i>
                  </button>
                </div>
                <div class="editor-content" contenteditable="true"></div>
              </div>
            </div>

            <div class="form-grid">
              <div class="form-group">
                <label>Especifica√ß√µes T√©cnicas</label>
                <div style="background: rgba(26, 0, 43, 0.5); border-radius: 10px; padding: 20px;">
                  <div id="specifications">
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                      <input type="text" class="form-control" placeholder="Ex: Material">
                      <input type="text" class="form-control" placeholder="Ex: PLA Premium">
                      <button type="button"
                        style="background: transparent; border: 1px solid rgba(124, 58, 237, 0.3); color: #f44336; border-radius: 6px; width: 40px;">
                        <i class="fas fa-times"></i>
                      </button>
                    </div>
                  </div>
                  <button type="button"
                    style="margin-top: 10px; padding: 8px 15px; background: rgba(124, 58, 237, 0.1); border: 1px dashed rgba(124, 58, 237, 0.3); color: #C084FC; border-radius: 6px; width: 100%;">
                    <i class="fas fa-plus"></i> Adicionar Especifica√ß√£o
                  </button>
                </div>
              </div>

              <div class="form-group">
                <label>Informa√ß√µes de Envio</label>
                <div style="background: rgba(26, 0, 43, 0.5); border-radius: 10px; padding: 20px;">
                  <div style="margin-bottom: 15px;">
                    <label style="display: flex; align-items: center; gap: 10px;">
                      <input type="checkbox" checked>
                      <span>Produto f√≠sico (requer envio)</span>
                    </label>
                  </div>
                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                      <label style="display: block; margin-bottom: 8px; font-size: 13px;">Peso (kg)</label>
                      <input type="number" class="form-control" placeholder="0.45" step="0.01">
                    </div>
                    <div>
                      <label style="display: block; margin-bottom: 8px; font-size: 13px;">Dimens√µes (cm)</label>
                      <input type="text" class="form-control" placeholder="25x18x15">
                    </div>
                    <div>
                      <label style="display: block; margin-bottom: 8px; font-size: 13px;">Tempo de Produ√ß√£o</label>
                      <input type="text" class="form-control" placeholder="3-5 dias">
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="toggle-switch" style="margin-top: 20px;">
              <label class="switch">
                <input type="checkbox" checked>
                <span class="slider"></span>
              </label>
              <span>Dispon√≠vel para venda</span>
            </div>

            <div class="toggle-switch">
              <label class="switch">
                <input type="checkbox" checked>
                <span class="slider"></span>
              </label>
              <span>Destacar como produto em promo√ß√£o</span>
            </div>

            <div class="toggle-switch">
              <label class="switch">
                <input type="checkbox">
                <span class="slider"></span>
              </label>
              <span>Permitir avalia√ß√µes do produto</span>
            </div>
          </div>

          <!-- TAB 5: SEO -->
          <div class="tab-content" id="seoTab">
            <div class="form-group">
              <label>T√≠tulo SEO</label>
              <input type="text" class="form-control" placeholder="Cr√¢nio T-Rex 3D - Universo Paralelo Store">
              <div class="form-help">T√≠tulo que aparecer√° nos resultados de busca (recomendado: 50-60 caracteres)</div>
            </div>

            <div class="form-group">
              <label>Meta Descri√ß√£o</label>
              <textarea class="form-control" placeholder="Descri√ß√£o para os mecanismos de busca" rows="3"></textarea>
              <div class="form-help">Descri√ß√£o que aparecer√° nos resultados de busca (recomendado: 150-160 caracteres)
              </div>
            </div>

            <div class="form-group">
              <label>URL Amig√°vel (Slug)</label>
              <input type="text" class="form-control" placeholder="cranio-t-rex-3d">
              <div class="form-help">URL limpa para o produto (ex: seu-site.com/produtos/cranio-t-rex-3d)</div>
            </div>

            <div class="form-group">
              <label>Palavras-chave</label>
              <input type="text" class="form-control"
                placeholder="escultura 3d, t-rex, dinossauro, decora√ß√£o, impress√£o 3d">
              <div class="form-help">Separe por v√≠rgulas as palavras-chave relevantes</div>
            </div>

            <div class="seo-preview">
              <h4>Pr√©-visualiza√ß√£o do Resultado de Busca</h4>
              <div class="preview-item">
                <div class="preview-title">Cr√¢nio T-Rex 3D - Universo Paralelo Store</div>
                <div class="preview-url">https://universoparalelo.com/produtos/cranio-t-rex-3d</div>
                <div class="preview-description">Esta impressionante r√©plica do cr√¢nio do T-Rex √© perfeita para
                  apaixonados por paleontologia e decora√ß√£o √∫nica. Impressa em 3D com alta resolu√ß√£o, captura cada
                  detalhe...</div>
              </div>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <a href="products.html" class="btn-cancel">
              <i class="fas fa-times"></i>
              Cancelar
            </a>
            <button type="button" class="btn-save" id="saveDraftBtn">
              <i class="far fa-save"></i>
              Salvar Rascunho
            </button>
            <button type="submit" class="btn-save">
              <i class="fas fa-rocket"></i>
              Publicar Produto
            </button>
          </div>
        </form>
      </div>
    </main>
  </div>


<script>
  // === FUN√á√ïES GLOBAIS ===
  function showNotification(message, type = 'info') {
    console.log(`üì¢ Notifica√ß√£o [${type}]: ${message}`);

    const notification = document.createElement('div');
    notification.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: linear-gradient(135deg, #1a002b, #0b0015);
    border: 2px solid ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#7C3AED'};
    color: white;
    padding: 15px 25px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    gap: 15px;
    z-index: 10000;
    animation: slideIn 0.3s ease;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    max-width: 400px;
  `;

    const icon = type === 'success' ? 'check-circle' :
      type === 'error' ? 'exclamation-circle' :
        type === 'warning' ? 'exclamation-triangle' : 'info-circle';

    notification.innerHTML = `
    <i class="fas fa-${icon}" style="color: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : type === 'warning' ? '#ff9800' : '#7C3AED'}; font-size: 20px;"></i>
    <span>${message}</span>
  `;

    document.body.appendChild(notification);

    setTimeout(() => {
      notification.style.animation = 'fadeOut 0.3s ease';
      setTimeout(() => notification.remove(), 300);
    }, 4000);
  }

  // === VARI√ÅVEIS GLOBAIS (para acesso externo) ===
  let mainImageData = null;
  let galleryImagesData = [];
  let collectAllFormData; // Ser√° definida dentro do DOMContentLoaded

  // === ANIMA√á√ïES CSS ===
  const style = document.createElement('style');
  style.textContent = `
  @keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
  @keyframes fadeOut {
    from { opacity: 1; transform: translateX(0); }
    to { opacity: 0; transform: translateX(100%); }
  }
`;
  document.head.appendChild(style);

  // === DEBUG HELPER ===
  window.debugForm = function () {
    if (typeof collectAllFormData === 'function') {
      const data = collectAllFormData();
      console.log("üîç DEBUG - Dados do formul√°rio:", data);
      alert(`Debug:\nNome: ${data.name}\nPre√ßo: R$ ${data.price}\nCategoria: ${data.category}\nStatus: ${data.status}`);
    } else {
      console.error("collectAllFormData n√£o est√° definida");
      alert("A fun√ß√£o collectAllFormData n√£o foi carregada ainda");
    }
  };

  document.addEventListener('DOMContentLoaded', function () {
    console.log("üì± Formul√°rio carregado");

    // Verificar login
    const isLoggedIn = localStorage.getItem('adminLoggedIn') === 'true';
    if (!isLoggedIn) {
      window.location.href = 'login.html';
      return;
    }

    // === 1. SISTEMA DE TABS ===
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');

    tabButtons.forEach(button => {
      button.addEventListener('click', function () {
        const tabId = this.getAttribute('data-tab');

        // Remover active de todos
        tabButtons.forEach(btn => btn.classList.remove('active'));
        tabContents.forEach(content => content.classList.remove('active'));

        // Adicionar active ao atual
        this.classList.add('active');
        const tabElement = document.getElementById(`${tabId}Tab`);
        if (tabElement) {
          tabElement.classList.add('active');
        }
      });
    });

    // === 2. GERENCIAMENTO DE IMAGENS ===
    const mainImageUpload = document.getElementById('mainImageUpload');
    const galleryUpload = document.getElementById('galleryUpload');
    const mainImagePreview = document.getElementById('mainImagePreview');
    const imageGallery = document.getElementById('imagePreview');

    if (mainImageUpload) {
      mainImageUpload.addEventListener('click', function () {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';

        input.onchange = function (e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (event) {
              mainImagePreview.innerHTML = `
              <div class="preview-item">
                <img src="${event.target.result}" alt="Preview" style="max-width: 200px; max-height: 200px;">
                <button type="button" class="remove-image" onclick="window.removeMainImage()">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            `;
              mainImageData = event.target.result; // base64
              console.log("üì∑ Imagem principal carregada");
            };
            reader.readAsDataURL(file);
          }
        };
        input.click();
      });
    }

    if (galleryUpload) {
      galleryUpload.addEventListener('click', function () {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        input.multiple = true;

        input.onchange = function (e) {
          Array.from(e.target.files).forEach(file => {
            const reader = new FileReader();
            reader.onload = function (event) {
              const div = document.createElement('div');
              div.className = 'preview-item';
              div.innerHTML = `
              <img src="${event.target.result}" alt="Gallery image" style="max-width: 150px; max-height: 150px;">
              <button type="button" class="remove-image" onclick="this.parentElement.remove()">
                <i class="fas fa-times"></i>
              </button>
            `;
              imageGallery.appendChild(div);

              galleryImagesData.push(event.target.result);
              console.log("üñºÔ∏è Imagem da galeria adicionada");
            };
            reader.readAsDataURL(file);
          });
        };
        input.click();
      });
    }

    // Fun√ß√µes globais para remover imagens
    window.removeMainImage = function () {
      if (mainImagePreview) {
        mainImagePreview.innerHTML = '';
      }
      mainImageData = null;
      console.log("üóëÔ∏è Imagem principal removida");
    };

    // === 3. EDITOR DE TEXTO ===
    const editorButtons = document.querySelectorAll('.editor-btn');
    const editorContent = document.querySelector('.editor-content');

    if (editorButtons.length > 0 && editorContent) {
      editorButtons.forEach(button => {
        button.addEventListener('click', function () {
          const command = this.getAttribute('data-command');
          document.execCommand(command, false, null);
          editorContent.focus();
        });
      });
    }

    // === 4. ADICIONAR ESPECIFICA√á√ïES ===
    // CORRE√á√ÉO: Use um seletor que funcione - vamos encontrar o bot√£o pelo texto dentro dele
    const allButtons = document.querySelectorAll('button');
    let addSpecBtn = null;

    // Encontrar o bot√£o pelo texto
    for (let btn of allButtons) {
      if (btn.textContent.includes('Adicionar Especifica√ß√£o')) {
        addSpecBtn = btn;
        break;
      }
    }

    // Ou use um seletor mais espec√≠fico baseado na estrutura HTML
    if (!addSpecBtn) {
      // Tente encontrar por seletor de atributo ou estrutura
      addSpecBtn = document.querySelector('#detailsTab button');
    }

    if (addSpecBtn) {
      addSpecBtn.addEventListener('click', function () {
        const specsContainer = document.getElementById('specifications');
        if (specsContainer) {
          const newSpec = document.createElement('div');
          newSpec.style.cssText = 'display: flex; gap: 10px; margin-bottom: 10px;';
          newSpec.innerHTML = `
          <input type="text" class="form-control" placeholder="Ex: Material">
          <input type="text" class="form-control" placeholder="Ex: PLA Premium">
          <button type="button" class="remove-spec" style="background: transparent; border: 1px solid rgba(124, 58, 237, 0.3); color: #f44336; border-radius: 6px; width: 40px;">
            <i class="fas fa-times"></i>
          </button>
        `;
          specsContainer.appendChild(newSpec);

          newSpec.querySelector('.remove-spec').addEventListener('click', function () {
            newSpec.remove();
          });

          console.log("‚ûï Especifica√ß√£o adicionada");
        }
      });
    }

    // === 5. FORMUL√ÅRIO PRINCIPAL ===
    const productForm = document.getElementById('productForm');
    const saveDraftBtn = document.getElementById('saveDraftBtn');

    if (!productForm) {
      console.error("‚ùå FORMUL√ÅRIO N√ÉO ENCONTRADO!");
      return;
    }

    // === 6. COLETA DE DADOS ===
    collectAllFormData = function () {
      console.log("üìã Coletando dados do formul√°rio...");

      // TAB 1: Informa√ß√µes B√°sicas
      const nameInput = document.querySelector('#basicTab input[placeholder*="Cr√¢nio T-Rex 3D"]');
      const categorySelect = document.querySelector('#basicTab select');
      const skuInput = document.querySelector('#basicTab input[placeholder*="SKU"]');
      const priceInput = document.querySelector('#basicTab input[placeholder*="120.00"]');
      const promoPriceInput = document.querySelector('#basicTab input[placeholder*="150.00"]');
      const stockInput = document.querySelector('#basicTab input[placeholder*="12"]');
      const shortDescTextarea = document.querySelector('#basicTab textarea');

      const name = nameInput ? nameInput.value : '';
      const category = categorySelect ? categorySelect.value : '';
      const sku = skuInput ? skuInput.value : '';
      const price = priceInput ? parseFloat(priceInput.value) || 0 : 0;
      const promotionalPrice = promoPriceInput ? parseFloat(promoPriceInput.value) || null : null;
      const stock = stockInput ? parseInt(stockInput.value) || 0 : 0;
      const shortDescription = shortDescTextarea ? shortDescTextarea.value : '';

      console.log("üìä Dados b√°sicos:", { name, category, price, stock });

      // TAB 2: Imagens
      const imageUrl = mainImageData || '';
      const additionalImages = galleryImagesData || [];

      // TAB 3: Variantes
      const sizes = [];
      const sizeCheckboxes = document.querySelectorAll('#variantsTab input[type="checkbox"]');
      const sizePriceInputs = document.querySelectorAll('#variantsTab input[placeholder*="00"]');

      sizeCheckboxes.forEach((checkbox, index) => {
        if (checkbox.checked && checkbox.nextElementSibling) {
          const sizeText = checkbox.nextElementSibling.textContent.trim();
          const priceInput = sizePriceInputs[index];
          const sizePrice = priceInput ? parseFloat(priceInput.value) : null;

          sizes.push({
            size: sizeText,
            price: sizePrice
          });
        }
      });

      // Cores
      const selectedColor = document.querySelector('#variantsTab .color-option.selected');
      const color = selectedColor ? selectedColor.getAttribute('title') : '';

      // TAB 4: Detalhes
      const description = editorContent ? editorContent.innerHTML : '';

      // Especifica√ß√µes
      const specifications = [];
      const specElements = document.querySelectorAll('#detailsTab #specifications > div');
      specElements.forEach(spec => {
        const inputs = spec.querySelectorAll('input');
        if (inputs.length >= 2 && inputs[0].value && inputs[1].value) {
          specifications.push({
            key: inputs[0].value,
            value: inputs[1].value
          });
        }
      });

      // Informa√ß√µes de envio
      const physicalCheckbox = document.querySelector('#detailsTab input[type="checkbox"]:first-of-type');
      const weightInput = document.querySelector('#detailsTab input[placeholder*="0.45"]');
      const dimensionsInput = document.querySelector('#detailsTab input[placeholder*="25x18x15"]');
      const productionInput = document.querySelector('#detailsTab input[placeholder*="3-5 dias"]');

      const isPhysical = physicalCheckbox ? physicalCheckbox.checked : false;
      const weight = weightInput ? weightInput.value : '';
      const dimensions = dimensionsInput ? dimensionsInput.value : '';
      const productionTime = productionInput ? productionInput.value : '';

      // Switches
      const switches = document.querySelectorAll('#detailsTab .toggle-switch input[type="checkbox"]');
      const availableForSale = switches[0] ? switches[0].checked : false;
      const isFeatured = switches[1] ? switches[1].checked : false;
      const allowReviews = switches[2] ? switches[2].checked : false;

      // TAB 5: SEO
      const seoTitleInput = document.querySelector('#seoTab input[placeholder*="T√≠tulo SEO"]');
      const seoDescTextarea = document.querySelector('#seoTab textarea[placeholder*="Meta Descri√ß√£o"]');
      const slugInput = document.querySelector('#seoTab input[placeholder*="URL Amig√°vel"]');
      const keywordsInput = document.querySelector('#seoTab input[placeholder*="Palavras-chave"]');

      const seoTitle = seoTitleInput ? seoTitleInput.value : '';
      const metaDescription = seoDescTextarea ? seoDescTextarea.value : '';
      const slug = slugInput ? slugInput.value : '';
      const keywords = keywordsInput ? keywordsInput.value.split(',').map(k => k.trim()).filter(k => k) : [];

      // Montar objeto final
      const productData = {
        name: name,
        description: description,
        short_description: shortDescription,
        price: price,
        promotional_price: promotionalPrice,
        category: category,
        stock: stock,
        sku: sku,
        image_url: imageUrl,
        images: additionalImages,
        material: specifications.find(s => s.key && s.key.toLowerCase() === 'material')?.value || '',
        dimensions: dimensions,
        weight: weight,
        featured: isFeatured,
        status: availableForSale ? 'active' : 'inactive',

        // Campos adicionais (JSON)
        variants: {
          sizes: sizes,
          colors: color ? [color] : [],
          custom_color: document.querySelector('#variantsTab input[type="color"]')?.value || ''
        },
        specifications: specifications,
        shipping_info: {
          is_physical: isPhysical,
          weight_kg: parseFloat(weight) || 0,
          dimensions_cm: dimensions,
          production_time: productionTime
        },
        seo: {
          title: seoTitle,
          description: metaDescription,
          slug: slug,
          keywords: keywords
        },
        settings: {
          allow_reviews: allowReviews
        }
      };

      console.log("‚úÖ Dados coletados:", productData);
      return productData;
    };

    // === 7. VALIDA√á√ÉO ===
    function validateProductData(data) {
      console.log("üîç Validando dados...");

      if (!data.name || !data.name.trim()) {
        showNotification('Nome do produto √© obrigat√≥rio!', 'error');
        return false;
      }

      if (!data.category || !data.category.trim()) {
        showNotification('Categoria √© obrigat√≥ria!', 'error');
        return false;
      }

      if (data.price <= 0) {
        showNotification('Pre√ßo deve ser maior que zero!', 'error');
        return false;
      }

      console.log("‚úÖ Valida√ß√£o passou");
      return true;
    }

    // === 8. ENVIO DO FORMUL√ÅRIO ===
    productForm.addEventListener('submit', async function (e) {
      e.preventDefault();
      console.log("üöÄ Enviando formul√°rio...");

      // Coletar dados
      const productData = collectAllFormData();

      // Validar
      if (!validateProductData(productData)) {
        return;
      }

      // Mostrar loading
      const submitBtn = productForm.querySelector('button[type="submit"]');
      const originalHTML = submitBtn.innerHTML;
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Publicando...';
      submitBtn.disabled = true;

      if (saveDraftBtn) {
        saveDraftBtn.disabled = true;
      }

      try {
        console.log("üì§ Enviando para API:", productData);

        // Verificar se ProductAPI existe
        if (typeof ProductAPI === 'undefined') {
          throw new Error("ProductAPI n√£o foi carregada. Verifique o arquivo api.js");
        }

        // Enviar para API
        const result = await ProductAPI.createProduct(productData);
        console.log("üì• Resposta da API:", result);

        if (result.success) {
          showNotification('üéâ Produto publicado com sucesso!', 'success');

          // Redirecionar ap√≥s 2 segundos
          setTimeout(() => {
            window.location.href = 'products.html';
          }, 2000);
        } else {
          showNotification(`‚ùå Erro: ${result.error || 'N√£o foi poss√≠vel criar o produto'}`, 'error');
          submitBtn.innerHTML = originalHTML;
          submitBtn.disabled = false;
          if (saveDraftBtn) saveDraftBtn.disabled = false;
        }
      } catch (error) {
        console.error("üí• Erro no envio:", error);
        showNotification(`‚ùå Erro: ${error.message || 'Falha na conex√£o'}`, 'error');
        submitBtn.innerHTML = originalHTML;
        submitBtn.disabled = false;
        if (saveDraftBtn) saveDraftBtn.disabled = false;
      }
    });

    // === 9. BOT√ÉO SALVAR RASCUNHO ===
    if (saveDraftBtn) {
      saveDraftBtn.addEventListener('click', function () {
        const productData = collectAllFormData();

        if (!productData.name) {
          showNotification('Digite pelo menos o nome do produto para salvar rascunho', 'warning');
          return;
        }

        const draftId = 'draft_' + Date.now();
        localStorage.setItem(draftId, JSON.stringify({
          data: productData,
          timestamp: new Date().toISOString(),
          title: productData.name || 'Novo produto'
        }));

        // Salvar lista de rascunhos
        const drafts = JSON.parse(localStorage.getItem('product_drafts') || '[]');
        drafts.push({
          id: draftId,
          title: productData.name || 'Novo produto',
          timestamp: new Date().toISOString()
        });
        localStorage.setItem('product_drafts', JSON.stringify(drafts));

        showNotification('üìù Rascunho salvo com sucesso!', 'info');
      });
    }

    // === 10. FUN√á√ïES AUXILIARES ===
    // Atualizar pr√©-visualiza√ß√£o SEO
    const seoTitleInput = document.querySelector('#seoTab input[placeholder*="T√≠tulo SEO"]');
    const seoDescTextarea = document.querySelector('#seoTab textarea[placeholder*="Meta Descri√ß√£o"]');
    const seoUrlInput = document.querySelector('#seoTab input[placeholder*="URL Amig√°vel"]');

    if (seoTitleInput && seoDescTextarea && seoUrlInput) {
      seoTitleInput.addEventListener('input', updateSeoPreview);
      seoDescTextarea.addEventListener('input', updateSeoPreview);
      seoUrlInput.addEventListener('input', updateSeoPreview);

      function updateSeoPreview() {
        const preview = document.querySelector('.seo-preview .preview-item');
        if (preview) {
          const titleEl = preview.querySelector('.preview-title');
          const urlEl = preview.querySelector('.preview-url');
          const descEl = preview.querySelector('.preview-description');

          if (seoTitleInput.value) titleEl.textContent = seoTitleInput.value;
          if (seoUrlInput.value) urlEl.textContent = `https://universoparalelo.com/produtos/${seoUrlInput.value}`;
          if (seoDescTextarea.value) descEl.textContent = seoDescTextarea.value.substring(0, 160) + '...';
        }
      }

      // Inicializar pr√©-visualiza√ß√£o
      updateSeoPreview();
    }

    // Gerar SKU autom√°tico
    const skuField = document.querySelector('#basicTab input[placeholder*="SKU"]');
    const nameField = document.querySelector('#basicTab input[placeholder*="Nome do Produto"]');

    if (skuField && nameField) {
      nameField.addEventListener('blur', function () {
        if (!skuField.value.trim()) {
          const sku = 'PROD-' + Math.floor(Math.random() * 1000).toString().padStart(3, '0');
          skuField.value = sku;
        }
      });

      // Gerar URL autom√°tica
      nameField.addEventListener('input', function () {
        if (seoUrlInput && !seoUrlInput.value.trim()) {
          const slug = this.value
            .toLowerCase()
            .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
            .replace(/[^\w\s-]/g, '')
            .replace(/\s+/g, '-')
            .replace(/-+/g, '-')
            .trim();
          seoUrlInput.value = slug;
          updateSeoPreview();
        }
      });
    }

    // === 11. BOT√ÉO DE DEBUG ===
    // Adiciona bot√£o de debug vis√≠vel
    const debugBtn = document.createElement('button');
    debugBtn.textContent = 'üêõ Debug';
    debugBtn.style.cssText = 'position: fixed; bottom: 20px; left: 20px; padding: 10px 15px; background: #7C3AED; color: white; border: none; border-radius: 5px; cursor: pointer; z-index: 10000;';
    debugBtn.onclick = window.debugForm;
    document.body.appendChild(debugBtn);

    console.log("‚úÖ Formul√°rio inicializado com sucesso");
  });
</script>
</body>

</html>