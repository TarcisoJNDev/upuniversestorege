<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Produtos - Admin</title>
  <link rel="stylesheet" href="../public/css/base.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="../admin/products.css">
  <script src="../public/js/config.js"></script>
</head>

<body>
  <div class="admin-wrapper">
    <!-- SIDEBAR -->
    <aside class="admin-sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">UNIVERSO PARALELO</div>
        <div class="admin-status">
          <span class="status-dot"></span>
          <span>Admin Online</span>
        </div>
      </div>

      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="section-title">Principal</div>
          <a href="dashboard.html" class="nav-link">
            <i class="fas fa-tachometer-alt"></i>
            <span>Dashboard</span>
          </a>
          <a href="products.html" class="nav-link active">
            <i class="fas fa-cube"></i>
            <span>Produtos</span>
          </a>
          <a href="categories.html" class="nav-link">
            <i class="fas fa-tags"></i>
            <span>Categorias</span>
          </a>
          <a href="#" class="nav-link disabled">
            <i class="fas fa-shopping-cart"></i>
            <span>Pedidos</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="section-title">Conte√∫do</div>
          <a href="#" class="nav-link disabled">
            <i class="fas fa-images"></i>
            <span>Banners</span>
          </a>
          <a href="#" class="nav-link disabled">
            <i class="fas fa-star"></i>
            <span>Avalia√ß√µes</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="section-title">Configura√ß√µes</div>
          <a href="#" class="nav-link disabled">
            <i class="fas fa-cog"></i>
            <span>Configura√ß√µes</span>
          </a>
          <a href="#" class="nav-link disabled">
            <i class="fas fa-chart-line"></i>
            <span>Relat√≥rios</span>
          </a>
        </div>
      </nav>

      <div class="sidebar-footer">
        <div class="admin-profile">
          <div class="profile-avatar">A</div>
          <div class="profile-info">
            <h4>Admin Master</h4>
            <p>Super Admin</p>
          </div>
        </div>
        <button class="btn-logout" id="logoutBtn">
          <i class="fas fa-sign-out-alt"></i>
          <span>Sair</span>
        </button>
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="admin-main">
      <header class="products-header">
        <div class="header-title">
          <h1><i class="fas fa-cube"></i> Gerenciar Produtos</h1>
          <p>Gerencie todos os produtos da sua loja</p>
        </div>
        <div class="products-toolbar">
          <div class="search-box">
            <i class="fas fa-search search-icon"></i>
            <input type="text" class="search-input" placeholder="Buscar produtos..." id="searchInput">
          </div>
          <a href="product-form.html" class="btn-new-product">
            <i class="fas fa-plus"></i>
            Novo Produto
          </a>
        </div>
      </header>

      <!-- Filtros -->
      <div class="products-filters">
        <select class="filter-select" id="categoryFilter">
          <option value="">Todas as categorias</option>
          <!-- Categorias ser√£o carregadas dinamicamente aqui -->
        </select>

        <select class="filter-select" id="statusFilter">
          <option value="">Todos os status</option>
          <option value="active">Ativo</option>
          <option value="inactive">Inativo</option>
        </select>

        <select class="filter-select" id="sortFilter">
          <option value="newest">Mais recentes</option>
          <option value="name_asc">Nome (A-Z)</option>
          <option value="name_desc">Nome (Z-A)</option>
          <option value="price_asc">Pre√ßo (menor)</option>
          <option value="price_desc">Pre√ßo (maior)</option>
        </select>

        <button class="btn-action btn-view" style="padding: 12px 25px;" id="applyFiltersBtn">
          <i class="fas fa-filter"></i>
          Aplicar
        </button>

        <button class="btn-action btn-view" style="padding: 12px 25px; background: #4CAF50;" id="refreshBtn">
          <i class="fas fa-sync-alt"></i>
          Atualizar
        </button>
      </div>

      <!-- Tabela de Produtos -->
      <div class="products-table-container">
        <table class="products-table">
          <thead>
            <tr>
              <th style="width: 50px;">
                <input type="checkbox" id="selectAll">
              </th>
              <th>Produto</th>
              <th>Categoria</th>
              <th>Pre√ßo</th>
              <th>Estoque</th>
              <th>Status</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="productsTableBody">
            <tr id="loadingRow">
              <td colspan="7" style="text-align: center; padding: 40px;">
                <i class="fas fa-spinner fa-spin fa-2x" style="color: #7C3AED;"></i>
                <p style="margin-top: 10px;">Carregando produtos...</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagina√ß√£o -->
      <div class="pagination">
        <div class="pagination-info" id="paginationInfo">
          Carregando...
        </div>
        <div class="pagination-controls">
          <button class="btn-pagination" id="prevPageBtn" disabled>
            <i class="fas fa-chevron-left"></i>
            Anterior
          </button>
          <div class="page-numbers" id="pageNumbers">
            <span class="page-number active">1</span>
          </div>
          <button class="btn-pagination" id="nextPageBtn" disabled>
            Pr√≥xima
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>

      <!-- A√ß√µes em massa -->
      <div id="bulkActions"
        style="display: none; margin-top: 30px; padding: 20px; background: rgba(26, 0, 43, 0.7); border-radius: 12px; border: 1px solid rgba(124, 58, 237, 0.2); display: flex; gap: 15px; align-items: center;">
        <span style="color: #aaa; font-size: 14px;">Com <strong id="selectedCount">0</strong> selecionados:</span>
        <select id="bulkActionSelect"
          style="padding: 10px 15px; background: rgba(11, 0, 21, 0.8); border: 1px solid rgba(124, 58, 237, 0.3); border-radius: 8px; color: #fff; font-size: 13px;">
          <option value="">A√ß√µes em massa...</option>
          <option value="activate">Ativar selecionados</option>
          <option value="deactivate">Desativar selecionados</option>
          <option value="delete">Excluir selecionados</option>
        </select>
        <button id="applyBulkActionBtn"
          style="padding: 10px 20px; background: linear-gradient(135deg, #DF38FF, #7C3AED); border: none; border-radius: 8px; color: #fff; font-size: 13px; cursor: pointer;">
          Aplicar
        </button>
      </div>
    </main>
  </div>

  <!-- Modal de Confirma√ß√£o -->
  <div class="modal" id="deleteModal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeDeleteModal()">
        <i class="fas fa-times"></i>
      </button>
      <h2 class="modal-title">Excluir Produto</h2>
      <p class="modal-text" id="deleteModalText">
        Tem certeza que deseja excluir este produto? Esta a√ß√£o n√£o pode ser desfeita.
      </p>
      <div class="modal-actions">
        <button class="btn-modal cancel" onclick="closeDeleteModal()">
          Cancelar
        </button>
        <button class="btn-modal delete" onclick="confirmDelete()">
          Sim, excluir
        </button>
      </div>
    </div>
  </div>

  <script>
    // ============================================
    // ===== CONFIGURA√á√ÉO DA API =====
    // ============================================
    const IS_LOCALHOST = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
    const API_BASE_URL = IS_LOCALHOST ? 'http://localhost:5000/api' : 'https://upuniversestorege.onrender.com/api';

    console.log('üöÄ API Base URL:', API_BASE_URL);

    // ============================================
    // ===== API CLIENT =====
    // ============================================
    window.ProductAPI = {
      API_BASE_URL: API_BASE_URL,

      async request(endpoint, options = {}, timeout = 30000) {
        const url = endpoint.startsWith('http') ? endpoint : `${API_BASE_URL}${endpoint}`;
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), timeout);

        try {
          const response = await fetch(url, {
            ...options,
            signal: controller.signal,
            headers: options.body instanceof FormData ? {} : { 'Content-Type': 'application/json' }
          });
          clearTimeout(timeoutId);

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
          }

          const contentType = response.headers.get('content-type');
          if (contentType && contentType.includes('application/json')) {
            return await response.json();
          }
          return await response.text();
        } catch (error) {
          clearTimeout(timeoutId);
          console.error(`‚ùå Erro na requisi√ß√£o ${url}:`, error);
          throw error;
        }
      },

      // Categorias
      async getAllCategories() {
        try {
          const data = await this.request('/categories');
          return data.categories || [];
        } catch (error) {
          console.error('‚ùå Erro ao buscar categorias:', error);
          return [];
        }
      },

      // Produtos
      async getAllProducts(filters = {}) {
        try {
          const params = new URLSearchParams();
          if (filters.category) params.append('category', filters.category);
          if (filters.category_id) params.append('category_id', filters.category_id);
          if (filters.status) params.append('status', filters.status);
          if (filters.search) params.append('search', filters.search);

          const query = params.toString() ? `?${params.toString()}` : '';
          const data = await this.request(`/products${query}`);
          return data.products || [];
        } catch (error) {
          console.error('‚ùå Erro ao buscar produtos:', error);
          return [];
        }
      },

      async deleteProduct(id) {
        try {
          const result = await this.request(`/products/${id}`, { method: 'DELETE' });
          return result;
        } catch (error) {
          console.error(`‚ùå Erro ao deletar produto ${id}:`, error);
          return { success: false, error: error.message };
        }
      },

      async updateProduct(id, data) {
        try {
          const result = await this.request(`/products/${id}`, {
            method: 'PUT',
            body: JSON.stringify(data)
          });
          return result;
        } catch (error) {
          console.error(`‚ùå Erro ao atualizar produto ${id}:`, error);
          return { success: false, error: error.message };
        }
      }
    };

    // ============================================
    // ===== FUN√á√ïES DE NOTIFICA√á√ÉO =====
    // ============================================
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #1a002b, #0b0015);
        border: 2px solid ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#7C3AED'};
        color: white;
        padding: 15px 25px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        gap: 15px;
        z-index: 10000;
        animation: slideIn 0.3s ease;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        max-width: 400px;
      `;

      const icon = type === 'success' ? 'check-circle' :
        type === 'error' ? 'exclamation-circle' :
          type === 'warning' ? 'exclamation-triangle' : 'info-circle';

      notification.innerHTML = `
        <i class="fas fa-${icon}" style="color: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : type === 'warning' ? '#ff9800' : '#7C3AED'}; font-size: 20px;"></i>
        <span>${message}</span>
      `;

      document.body.appendChild(notification);
      setTimeout(() => {
        notification.style.animation = 'fadeOut 0.3s ease';
        setTimeout(() => notification.remove(), 300);
      }, 4000);
    }

    // ============================================
    // ===== GERENCIAMENTO DE PRODUTOS =====
    // ============================================
    document.addEventListener('DOMContentLoaded', function () {
      console.log('üì¶ Iniciando p√°gina de produtos...');

      // Verificar login
      const isLoggedIn = localStorage.getItem('adminLoggedIn') === 'true';
      if (!isLoggedIn) {
        window.location.href = 'login.html';
        return;
      }

      // Logout
      const logoutBtn = document.getElementById('logoutBtn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', function () {
          if (confirm('Tem certeza que deseja sair?')) {
            localStorage.removeItem('adminLoggedIn');
            localStorage.removeItem('adminEmail');
            window.location.href = 'login.html';
          }
        });
      }

      // Info do admin
      const adminEmail = localStorage.getItem('adminEmail');
      const profileName = document.querySelector('.profile-info h4');
      if (adminEmail && profileName) {
        profileName.textContent = adminEmail.split('@')[0];
      }

      const profileAvatar = document.querySelector('.profile-avatar');
      if (adminEmail && profileAvatar) {
        profileAvatar.textContent = adminEmail.split('@')[0].charAt(0).toUpperCase();
      }

      // Vari√°veis globais
      let allProducts = [];
      let filteredProducts = [];
      let allCategories = [];
      let currentPage = 1;
      const productsPerPage = 10;
      let productToDelete = null;

      // Elementos DOM
      const searchInput = document.getElementById('searchInput');
      const categoryFilter = document.getElementById('categoryFilter');
      const statusFilter = document.getElementById('statusFilter');
      const sortFilter = document.getElementById('sortFilter');
      const applyFiltersBtn = document.getElementById('applyFiltersBtn');
      const refreshBtn = document.getElementById('refreshBtn');
      const productsTableBody = document.getElementById('productsTableBody');
      const paginationInfo = document.getElementById('paginationInfo');
      const prevPageBtn = document.getElementById('prevPageBtn');
      const nextPageBtn = document.getElementById('nextPageBtn');
      const pageNumbers = document.getElementById('pageNumbers');
      const bulkActions = document.getElementById('bulkActions');
      const selectedCount = document.getElementById('selectedCount');
      const bulkActionSelect = document.getElementById('bulkActionSelect');
      const applyBulkActionBtn = document.getElementById('applyBulkActionBtn');
      const selectAll = document.getElementById('selectAll');

      // ===== FUN√á√ïES =====
      async function loadCategories() {
        try {
          allCategories = await ProductAPI.getAllCategories();
          console.log(`‚úÖ ${allCategories.length} categorias carregadas`);

          categoryFilter.innerHTML = '<option value="">Todas as categorias</option>';

          allCategories.sort((a, b) => a.name.localeCompare(b.name)).forEach(category => {
            const option = document.createElement('option');
            option.value = category.id;
            option.textContent = category.name;
            categoryFilter.appendChild(option);
          });
        } catch (error) {
          console.error('‚ùå Erro ao carregar categorias:', error);
        }
      }

      function getImageUrl(imagePath) {
        if (!imagePath) return 'https://via.placeholder.com/50x50/7C3AED/FFFFFF?text=Sem+Imagem';
        if (imagePath.startsWith('http')) return imagePath;
        if (imagePath.startsWith('/')) return `https://upuniversestorege.onrender.com${imagePath}`;
        return `https://upuniversestorege.onrender.com/uploads/${imagePath}`;
      }

      function getCategoryName(categoryId) {
        if (!categoryId) return 'Sem categoria';
        const category = allCategories.find(c => c.id == categoryId);
        return category ? category.name : 'Sem categoria';
      }

      function getStockStatus(product) {
        if (product.status === 'inactive') {
          return { class: 'stock-out', icon: 'fas fa-ban', text: 'Inativo' };
        }
        if (product.stock === 0) {
          return { class: 'stock-out', icon: 'fas fa-times-circle', text: 'Esgotado' };
        }
        if (product.stock <= 5) {
          return { class: 'stock-low', icon: 'fas fa-exclamation-triangle', text: 'Estoque baixo' };
        }
        return { class: 'stock-in', icon: 'fas fa-check-circle', text: 'Em estoque' };
      }

      function formatPrice(price) {
        return new Intl.NumberFormat('pt-BR', {
          style: 'currency',
          currency: 'BRL'
        }).format(price || 0);
      }

      async function loadProducts() {
        try {
          console.log('üì• Carregando produtos...');
          productsTableBody.innerHTML = `
            <tr>
              <td colspan="7" style="text-align: center; padding: 40px;">
                <i class="fas fa-spinner fa-spin fa-2x" style="color: #7C3AED;"></i>
                <p style="margin-top: 10px;">Carregando produtos...</p>
              </td>
            </tr>
          `;

          await loadCategories();
          allProducts = await ProductAPI.getAllProducts();
          console.log(`‚úÖ ${allProducts.length} produtos carregados`);

          applyFilters();
        } catch (error) {
          console.error('‚ùå Erro ao carregar produtos:', error);
          productsTableBody.innerHTML = `
            <tr>
              <td colspan="7" style="text-align: center; padding: 40px; color: #f44336;">
                <i class="fas fa-exclamation-triangle fa-2x"></i>
                <p style="margin-top: 10px;">Erro ao carregar produtos</p>
                <button onclick="window.location.reload()" style="margin-top: 10px; padding: 8px 15px; background: #7C3AED; color: white; border: none; border-radius: 5px; cursor: pointer;">
                  Tentar novamente
                </button>
              </td>
            </tr>
          `;
        }
      }

      function applyFilters() {
        const searchTerm = searchInput.value.toLowerCase();
        const categoryId = categoryFilter.value;
        const status = statusFilter.value;
        const sortBy = sortFilter.value;

        filteredProducts = allProducts.filter(product => {
          const matchesSearch = !searchTerm ||
            product.name.toLowerCase().includes(searchTerm) ||
            (product.description && product.description.toLowerCase().includes(searchTerm)) ||
            (product.sku && product.sku.toLowerCase().includes(searchTerm));

          const matchesCategory = !categoryId || product.category_id == categoryId;
          const matchesStatus = !status || product.status === status;

          return matchesSearch && matchesCategory && matchesStatus;
        });

        filteredProducts.sort((a, b) => {
          switch (sortBy) {
            case 'name_asc': return a.name.localeCompare(b.name);
            case 'name_desc': return b.name.localeCompare(a.name);
            case 'price_asc': return a.price - b.price;
            case 'price_desc': return b.price - a.price;
            default: return new Date(b.created_at || 0) - new Date(a.created_at || 0);
          }
        });

        currentPage = 1;
        updateTable();
        updatePagination();
      }

      function updateTable() {
        const start = (currentPage - 1) * productsPerPage;
        const end = start + productsPerPage;
        const pageProducts = filteredProducts.slice(start, end);

        if (pageProducts.length === 0) {
          productsTableBody.innerHTML = `
            <tr>
              <td colspan="7" style="text-align: center; padding: 40px;">
                <i class="fas fa-box-open fa-2x" style="color: #7C3AED; opacity: 0.5;"></i>
                <p style="margin-top: 10px; color: #aaa;">Nenhum produto encontrado</p>
                ${filteredProducts.length === 0 && allProducts.length > 0 ?
              '<p style="color: #888;">Tente ajustar os filtros</p>' :
              '<a href="product-form.html" style="display: inline-block; margin-top: 10px; padding: 8px 15px; background: #7C3AED; color: white; text-decoration: none; border-radius: 5px;">Criar primeiro produto</a>'}
              </td>
            </tr>
          `;
          bulkActions.style.display = 'none';
          return;
        }

        let tableHTML = '';
        pageProducts.forEach(product => {
          const stockStatus = getStockStatus(product);
          const featuredStar = product.featured ?
            '<span style="margin-left: 5px; color: #FFD700;"><i class="fas fa-star"></i></span>' : '';

          tableHTML += `
            <tr data-product-id="${product.id}">
              <td><input type="checkbox" class="product-checkbox" data-product-id="${product.id}"></td>
              <td>
                <div style="display: flex; align-items: center; gap: 10px;">
                  <img src="${getImageUrl(product.image_url)}" alt="${product.name}" 
                       style="width: 50px; height: 50px; object-fit: cover; border-radius: 6px;"
                       onerror="this.src='https://via.placeholder.com/50x50/7C3AED/FFFFFF?text=Erro'">
                  <div>
                    <strong>${product.name}</strong> ${featuredStar}<br>
                    <small style="color: #aaa;">${product.sku || `ID: ${product.id}`}</small>
                  </div>
                </div>
              </td>
              <td>${getCategoryName(product.category_id)}</td>
              <td><strong style="color: #C084FC;">${formatPrice(product.price)}</strong></td>
              <td>${product.stock} un.</td>
              <td>
                <span class="stock-status ${stockStatus.class}">
                  <i class="${stockStatus.icon}"></i> ${stockStatus.text}
                </span>
              </td>
              <td>
                <div style="display: flex; gap: 5px;">
                  <button class="btn-action btn-view" onclick="editProduct(${product.id})">
                    <i class="far fa-edit"></i>
                  </button>
                  <button class="btn-action btn-delete" onclick="showDeleteModal(${product.id}, '${product.name.replace(/'/g, "\\'")}')">
                    <i class="far fa-trash-alt"></i>
                  </button>
                </div>
              </td>
            </tr>
          `;
        });

        productsTableBody.innerHTML = tableHTML;
        updateBulkActions();
      }

      function updatePagination() {
        const totalPages = Math.ceil(filteredProducts.length / productsPerPage);
        const start = (currentPage - 1) * productsPerPage + 1;
        const end = Math.min(currentPage * productsPerPage, filteredProducts.length);

        paginationInfo.innerHTML = filteredProducts.length > 0 ?
          `Mostrando <strong>${start}-${end}</strong> de <strong>${filteredProducts.length}</strong> produtos` :
          'Nenhum produto encontrado';

        prevPageBtn.disabled = currentPage === 1;
        nextPageBtn.disabled = currentPage === totalPages || totalPages === 0;

        let pagesHTML = '';
        for (let i = 1; i <= totalPages; i++) {
          pagesHTML += `<span class="page-number ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">${i}</span>`;
        }
        pageNumbers.innerHTML = pagesHTML;
      }

      function updateBulkActions() {
        const checked = document.querySelectorAll('.product-checkbox:checked');
        if (checked.length > 0) {
          bulkActions.style.display = 'flex';
          selectedCount.textContent = checked.length;
        } else {
          bulkActions.style.display = 'none';
        }
      }

      // ===== FUN√á√ïES GLOBAIS =====
      window.goToPage = function (page) {
        currentPage = page;
        updateTable();
        updatePagination();
      };

      window.editProduct = function (productId) {
        window.location.href = `product-form.html?edit=${productId}`;
      };

      window.showDeleteModal = function (productId, productName) {
        productToDelete = productId;
        const modal = document.getElementById('deleteModal');
        modal.classList.add('show');
        document.getElementById('deleteModalText').textContent =
          `Tem certeza que deseja excluir o produto "${productName}"? Esta a√ß√£o n√£o pode ser desfeita.`;
      };

      window.closeDeleteModal = function () {
        document.getElementById('deleteModal').classList.remove('show');
        productToDelete = null;
      };

      window.confirmDelete = async function () {
        if (!productToDelete) return;

        try {
          const result = await ProductAPI.deleteProduct(productToDelete);
          if (result.success) {
            showNotification('Produto exclu√≠do com sucesso!', 'success');
            allProducts = allProducts.filter(p => p.id !== productToDelete);
            filteredProducts = filteredProducts.filter(p => p.id !== productToDelete);
            updateTable();
            updatePagination();
          } else {
            showNotification(`Erro: ${result.error}`, 'error');
          }
        } catch (error) {
          showNotification('Erro ao excluir produto', 'error');
        }
        closeDeleteModal();
      };

      // ===== EVENT LISTENERS =====
      if (selectAll) {
        selectAll.addEventListener('change', function () {
          document.querySelectorAll('.product-checkbox').forEach(cb => cb.checked = this.checked);
          updateBulkActions();
        });
      }

      document.addEventListener('change', function (e) {
        if (e.target.classList.contains('product-checkbox')) updateBulkActions();
      });

      if (searchInput) {
        searchInput.addEventListener('input', function () {
          clearTimeout(this.searchTimeout);
          this.searchTimeout = setTimeout(applyFilters, 500);
        });
      }

      if (categoryFilter) categoryFilter.addEventListener('change', applyFilters);
      if (statusFilter) statusFilter.addEventListener('change', applyFilters);
      if (sortFilter) sortFilter.addEventListener('change', applyFilters);
      if (applyFiltersBtn) applyFiltersBtn.addEventListener('click', applyFilters);

      if (refreshBtn) {
        refreshBtn.addEventListener('click', () => {
          loadProducts();
          showNotification('Produtos atualizados!', 'info');
        });
      }

      if (prevPageBtn) prevPageBtn.addEventListener('click', () => goToPage(currentPage - 1));
      if (nextPageBtn) nextPageBtn.addEventListener('click', () => goToPage(currentPage + 1));

      if (applyBulkActionBtn) {
        applyBulkActionBtn.addEventListener('click', async function () {
          const action = bulkActionSelect.value;
          const selected = Array.from(document.querySelectorAll('.product-checkbox:checked'))
            .map(cb => parseInt(cb.dataset.productId));

          if (!action || selected.length === 0) {
            showNotification('Selecione uma a√ß√£o e pelo menos um produto', 'warning');
            return;
          }

          let success = 0, errors = 0;
          for (const id of selected) {
            try {
              if (action === 'delete') {
                const result = await ProductAPI.deleteProduct(id);
                if (result.success) success++; else errors++;
              } else {
                const result = await ProductAPI.updateProduct(id, {
                  status: action === 'activate' ? 'active' : 'inactive'
                });
                if (result.success) success++; else errors++;
              }
            } catch {
              errors++;
            }
          }

          await loadProducts();
          showNotification(`${success} sucesso(s), ${errors} erro(s)`, errors === 0 ? 'success' : 'warning');
          selectAll.checked = false;
        });
      }

      // Iniciar
      loadProducts();
    });

    // ===== ANIMA√á√ïES CSS =====
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes fadeOut {
        from { opacity: 1; transform: translateX(0); }
        to { opacity: 0; transform: translateX(100%); }
      }
    `;
    document.head.appendChild(style);
  </script>
</body>

</html>